<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB应用 | 小肥龙吃大冰淇淋</title><meta name="keywords" content="NoSQL,MongoDB"><meta name="author" content="小肥龙吃大冰淇淋"><meta name="copyright" content="小肥龙吃大冰淇淋"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. MongoDB体系结构1.1 NoSQL 和 MongoDBNoSQL&#x3D;Not Only SQL，支持类似SQL的功能， 与Relational Database相辅相成。其性能较高， 不使用SQL意味着没有结构化的存储要求(SQL为结构化的查询语句)，没有约束之后架构更加灵 活。NoSQL数据库四大家族列存储 Hbase,键值(Key-Value)存储 Redis,图像存储 Neo4j,文">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB应用">
<meta property="og:url" content="http://lvxueyang.vip/post/2c424ebd.html">
<meta property="og:site_name" content="小肥龙吃大冰淇淋">
<meta property="og:description" content="1. MongoDB体系结构1.1 NoSQL 和 MongoDBNoSQL&#x3D;Not Only SQL，支持类似SQL的功能， 与Relational Database相辅相成。其性能较高， 不使用SQL意味着没有结构化的存储要求(SQL为结构化的查询语句)，没有约束之后架构更加灵 活。NoSQL数据库四大家族列存储 Hbase,键值(Key-Value)存储 Redis,图像存储 Neo4j,文">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg">
<meta property="article:published_time" content="2024-05-30T01:10:36.363Z">
<meta property="article:modified_time" content="2022-11-27T09:16:36.794Z">
<meta property="article:author" content="小肥龙吃大冰淇淋">
<meta property="article:tag" content="NoSQL">
<meta property="article:tag" content="MongoDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg"><link rel="shortcut icon" href="https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210805191028.png"><link rel="canonical" href="http://lvxueyang.vip/post/2c424ebd"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MongoDB应用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:16:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/ali_icon.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mogai.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="小肥龙吃大冰淇淋" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">303</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">108</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">73</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小肥龙吃大冰淇淋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MongoDB应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-30T01:10:36.363Z" title="发表于 2024-05-30 09:10:36">2024-05-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T09:16:36.794Z" title="更新于 2022-11-27 17:16:36">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NoSQL/">NoSQL</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NoSQL/MongoDB/">MongoDB</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MongoDB应用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-MongoDB体系结构"><a href="#1-MongoDB体系结构" class="headerlink" title="1. MongoDB体系结构"></a>1. MongoDB体系结构</h1><h2 id="1-1-NoSQL-和-MongoDB"><a href="#1-1-NoSQL-和-MongoDB" class="headerlink" title="1.1 NoSQL 和 MongoDB"></a>1.1 NoSQL 和 MongoDB</h2><p>NoSQL=Not Only SQL，支持类似SQL的功能， 与Relational Database相辅相成。其性能较高， 不使用SQL意味着没有结构化的存储要求(SQL为结构化的查询语句)，没有约束之后架构更加灵 活。<br>NoSQL数据库四大家族列存储 Hbase,键值(Key-Value)存储 Redis,图像存储 Neo4j,文档存储 MongoDB<br>MongoDB 是一个基于分布式文件存储的数据库，由 C++ 编写，可以为 WEB 应用提供可扩展、 高性能、易部署的数据存储解决方案。<br>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库中功能最丰富、 最像关系数据库的。在高负载的情况下，通过添加更多的节点，可以保证服务器性能。 </p>
<h2 id="1-2-MongoDB-体系结构"><a href="#1-2-MongoDB-体系结构" class="headerlink" title="1.2 MongoDB 体系结构"></a>1.2 MongoDB 体系结构</h2><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041358502.png" alt="image-20220104135858438"></p>
<h2 id="1-3-MongoDB-和RDBMS-关系型数据库-对比"><a href="#1-3-MongoDB-和RDBMS-关系型数据库-对比" class="headerlink" title="1.3 MongoDB 和RDBMS(关系型数据库)对比"></a>1.3 MongoDB 和RDBMS(关系型数据库)对比</h2><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041359574.png" alt="image-20220104135919522"></p>
<h2 id="1-4-什么是BSON"><a href="#1-4-什么是BSON" class="headerlink" title="1.4 什么是BSON"></a>1.4 什么是BSON</h2><p>BSON是一种类json的一种二进制形式的存储格式，简称Binary JSON，它和JSON一样，支持内嵌的文 档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Date和Binary Data类型。BSON可以 做为网络数据交换的一种存储形式,是一种schema-less的存储形式，它的优点是灵活性高，但它的缺点是空间利用率不是很理想。 </p>
<p><code>&#123;key:value,key2:value2&#125;</code> 这是一个BSON的例子，其中key是字符串类型,后面的value值，它的类型一般是字符串,double,Array,ISODate等类型。 </p>
<p>BSON有三个特点：轻量性、可遍历性、高效性</p>
<h2 id="1-5-BSON在MongoDB中的使用"><a href="#1-5-BSON在MongoDB中的使用" class="headerlink" title="1.5 BSON在MongoDB中的使用"></a>1.5 BSON在MongoDB中的使用</h2><p> MongoDB使用了BSON这种结构来存储数据和网络数据交换。把这种格式转化成一文档这个概念 (Document)，这里的一个Document也可以理解成关系数据库中的一条记录(Record)，只是这里的 Document的变化更丰富一些，如Document可以嵌套。<br>MongoDB中Document 中 可以出现的数据类型 。</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041359529.png" alt="image-20220104135947467"></p>
<h2 id="1-6-MongoDB在Linux的安装"><a href="#1-6-MongoDB在Linux的安装" class="headerlink" title="1.6 MongoDB在Linux的安装"></a>1.6 MongoDB在Linux的安装</h2><p>1.下载社区版 MongoDB 4.1.3<br>去官网下载对应的MongoDB 然后上传到Linux虚拟机<br>2.将压缩包解压即可<br><code>tar -zxvf MongoDB-linux-x86_64-4.1.3.tgz </code><br>3.启动<br><code>./bin/mongod </code><br>4.指定配置文件方式的启动<br><code>./bin/mongod -f mongo.conf </code><br>配置文件样例: </p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">dbpath</span>=<span class="string">/data/mongo/ </span></span><br><span class="line"><span class="attr">port</span>=<span class="string">27017 </span></span><br><span class="line"><span class="attr">bind_ip</span>=<span class="string">0.0.0.0 </span></span><br><span class="line"><span class="attr">fork</span>=<span class="string">true </span></span><br><span class="line"><span class="attr">logpath</span> = <span class="string">/data/mongo/MongoDB.log </span></span><br><span class="line"><span class="attr">logappend</span> = <span class="string">true </span></span><br><span class="line"><span class="attr">auth</span>=<span class="string">false </span></span><br></pre></td></tr></table></figure>


<h2 id="1-7-MongoDB启动和参数说明"><a href="#1-7-MongoDB启动和参数说明" class="headerlink" title="1.7 MongoDB启动和参数说明"></a>1.7 MongoDB启动和参数说明</h2><p>参数 说明 </p>
<ul>
<li>dbpath 数据库目录，默认/data/db </li>
<li>port 监听的端口，默认27017 </li>
<li>bind_ip 监听IP地址，默认全部可以访问 </li>
<li>fork 是否已后台启动的方式登陆 </li>
<li>logpath 日志路径 </li>
<li>logappend 是否追加日志 </li>
<li>auth 是开启用户密码登陆 </li>
<li>config 指定配置文件 </li>
</ul>
<h2 id="1-8-mongo-shell-的启动"><a href="#1-8-mongo-shell-的启动" class="headerlink" title="1.8 mongo shell 的启动"></a>1.8 mongo shell 的启动</h2><p>启动mongo shell<br><code>./bin/mongo </code><br>指定主机和端口的方式启动<br><code>./bin/mongo --host=主机IP --port=端口</code></p>
<h2 id="1-9-Mongodb-GUI工具"><a href="#1-9-Mongodb-GUI工具" class="headerlink" title="1.9 Mongodb GUI工具"></a>1.9 Mongodb GUI工具</h2><h3 id="1-9-1-MongoDB-Compass-Community"><a href="#1-9-1-MongoDB-Compass-Community" class="headerlink" title="1.9.1 MongoDB Compass Community"></a>1.9.1 MongoDB Compass Community</h3><p>MongoDB Compass Community由MongoDB开发人员开发，这意味着更高的可靠性和兼容性。它为MongoDB提供GUI mongodb工具，以探索数据库交互,具有完整的CRUD功能并提供可视方式。借助内置模式可视化，用户可以分析文档并显示丰富的结构。为了监控服务器的负载，它提供了数据库操作的实时统计信息。就像MongoDB一样，Compass也有两个版本，一个是Enterprise（付费），社区可以免费使用。适用于Linux，Mac或Windows。 </p>
<h3 id="1-9-2-NoSQLBooster（mongobooster）"><a href="#1-9-2-NoSQLBooster（mongobooster）" class="headerlink" title="1.9.2 NoSQLBooster（mongobooster）"></a>1.9.2 NoSQLBooster（mongobooster）</h3><p>NoSQLBooster是MongoDB CLI界面中非常流行的GUI工具。它正式名称为MongoBooster。NoSQLBooster是一个跨平台，它带有一堆mongodb工具来管理数据库和监控服务器。这个Mongodb 工具包括服务器监控工具，Visual Explain Plan，查询构建器，SQL查询，ES2017语法支持等等……它有免费，个人和商业版本，当然，免费版本有一些功能限制。NoSQLBooster也可用于Windows，MacOS和Linux。 </p>
<h1 id="2-MongoDB命令"><a href="#2-MongoDB命令" class="headerlink" title="2. MongoDB命令"></a>2. MongoDB命令</h1><p>**2.1 MongoDB的基本操作 **</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">查看数据库 </span><br><span class="line">show dbs; </span><br><span class="line">切换数据库 如果没有对应的数据库则创建 </span><br><span class="line">use 数据库名;</span><br><span class="line"></span><br><span class="line">创建集合 </span><br><span class="line">db.createCollection(&quot;集合名&quot;) </span><br><span class="line"></span><br><span class="line">查看集合</span><br><span class="line">show tables;</span><br><span class="line">show collections; </span><br><span class="line"></span><br><span class="line">删除集合</span><br><span class="line">db.集合名.drop();</span><br><span class="line"></span><br><span class="line">删除当前数据库 </span><br><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure>
<p>**2.2 MongoDB集合数据操作（CURD） **</p>
<h3 id="2-2-1-数据添加"><a href="#2-2-1-数据添加" class="headerlink" title="2.2.1 数据添加"></a>2.2.1 数据添加</h3><ol>
<li>插入单条数据 db.集合名.insert(文档)<br> 文档的数据结构和JSON基本一样。<br> 所有存储在集合中的数据都是BSON格式。<br> BSON是一种类json的一种二进制形式的存储格式,简称Binary JSON。 </li>
</ol>
<ol start="2">
<li>例如:<br> db.lg_resume_preview.insert({name:”张晓峰”,birthday:new ISODate(“2000-07-01”),expectSalary:15000,gender:0,city:”bj”})<br> 没有指定 _id 这个字段 系统会自动生成当然我们也可以指定 _id ( _id 类型是ObjectId 类型是一个12字节 BSON 类型数据，有以下格式：<br> 前4个字节表示时间戳 ObjectId(“对象Id字符串”).getTimestamp() 来获取<br> 接下来的3个字节是机器标识码<br> 紧接的两个字节由进程id组成（PID）<br> 最后三个字节是随机数。) </li>
</ol>
<ol start="3">
<li>插入多条数据<br>db.集合名.insert([文档,文档])</li>
</ol>
<h3 id="2-2-2-数据查询"><a href="#2-2-2-数据查询" class="headerlink" title="2.2.2 数据查询"></a>2.2.2 数据查询</h3><p>**比较条件查询 **<br>db.集合名.fifind(条件) </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041402427.png" alt="image-20220104140206368"></p>
<p><strong>逻辑条件查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and 条件</span><br><span class="line">MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件 </span><br><span class="line">   db.集合名.find(&#123;key1:value1, key2:value2&#125;).pretty() </span><br><span class="line">or 条件</span><br><span class="line">  db.集合名.find(&#123;$or:[&#123;key1:value1&#125;, &#123;key2:value2&#125;]&#125;).pretty() </span><br><span class="line">not 条件</span><br><span class="line">   db.集合名.find(&#123;key:&#123;$not:&#123;$操作符:value&#125;&#125;).pretty()</span><br></pre></td></tr></table></figure>
<p>**分页查询 **<br>db.集合名.fifind({条件}).sort({排序字段:排序方式})).skip(跳过的行数).limit(一页显示多少数据)</p>
<h3 id="2-2-3-数据更新"><a href="#2-2-3-数据更新" class="headerlink" title="2.2.3 数据更新"></a>2.2.3 数据更新</h3><p>调用update</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$set</span> ：设置字段值</span><br><span class="line"><span class="variable">$unset</span> :删除指定字段</span><br><span class="line"><span class="variable">$inc</span>：对修改的值进行自增</span><br><span class="line">db.集合名.update( </span><br><span class="line">  &lt;query&gt;,</span><br><span class="line">  &lt;update&gt;, </span><br><span class="line">   &#123; </span><br><span class="line">    upsert: &lt;boolean&gt;,</span><br><span class="line">    multi: &lt;boolean&gt;,</span><br><span class="line">    writeConcern: &lt;document&gt; </span><br><span class="line">  &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>参数说明： </p>
<ul>
<li>query : update的查询条件，类似sql update查询内where后面的。 </li>
<li>update : update的对象和一些更新的操作符（如$set,$inc…）等，也可以理解为sql update中 set后面的 </li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认 是false，不插入。 </li>
<li>multi : 可选，MongoDB 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查 出来多条记录全部更新。 </li>
<li>writeConcern :可选，用来指定mongod对写操作的回执行为比如写的行为是否需要确认。 </li>
</ul>
<p>举例：<br><code>db.集合名.update(&#123;条件&#125;,&#123;$set:&#123;字段名:值&#125;&#125;,&#123;multi:true&#125;) </code></p>
<p>writeConcern 包括以下字段：<br><code>&#123; w: &lt;value&gt;, j: &lt;boolean&gt;, wtimeout: &lt;number&gt; &#125; </code><br>w:指定写操作传播到的成员数量 。</p>
<p>比如：<br>w=1（默认）:则要求得到写操作已经传播到独立的Mongod实例或副本集的primary成员的确认<br>w=0:则不要求确认写操作，可能会返回socket exceptions和 networking errors<br>w=”majority”:要求得到写操作已经传播到大多数具有存储数据具有投票的（data-bearing voting ）成员（也就是 members[n].votes 值大于0的成员）的确认 。<br>j:要求得到Mongodb的写操作已经写到硬盘日志的确认 </p>
<p>比如：<br>j=true:要求得到Mongodb(w指定的实例个数)的写操作已经写到硬盘日志的确认。j=true本身并不保证 因为副本集故障而不会回滚。<br>wtimeout:指定write concern的时间限制，只适用于w&gt;1的情况  wtimeout在超过指定时间后写操作会返回error，即使写操作最后执行成功，当这些写操作返回时， MongoDB不会撤消在wtimeout时间限制之前执行成功的数据修改。<br>如果未指定wtimeout选项且未指定write concern级别，则写入操作将无限期阻止。 指定wtimeout值 为0等同于没有wtimeout选项。 </p>
<h3 id="2-2-4-数据删除"><a href="#2-2-4-数据删除" class="headerlink" title="2.2.4 数据删除"></a>2.2.4 数据删除</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">db.collection.remove( </span><br><span class="line">  &lt;query&gt;, </span><br><span class="line">  &#123; justOne: &lt;boolean&gt;, writeConcern: &lt;document&gt; &#125; </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">query :（可选）删除的文档的条件。</span><br><span class="line">justOne : （可选）如果设为 <span class="literal">true</span> 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 <span class="literal">false</span>，则删除所有匹配条件的文档。 </span><br><span class="line">writeConcern :（可选）用来指定mongod对写操作的回执行为。</span><br></pre></td></tr></table></figure>
<h2 id="2-3-MongoDB-聚合操作"><a href="#2-3-MongoDB-聚合操作" class="headerlink" title="2.3 MongoDB 聚合操作"></a>2.3 MongoDB 聚合操作</h2><h3 id="2-3-1-聚合操作简介"><a href="#2-3-1-聚合操作简介" class="headerlink" title="2.3.1 聚合操作简介"></a>2.3.1 聚合操作简介</h3><p>聚合是MongoDB的高级查询语言，它允许我们通过转化合并由多个文档的数据来生成新的在单个文档 里不存在的文档信息。一般都是将记录按条件分组之后进行一系列求最大值，最小值，平均值的简单操作，也可以对记录进行复杂数据统计，数据挖掘的操作。聚合操作的输入是集中的文档，输出可以是一个文档也可以是多个文档。 </p>
<h3 id="2-3-2-MongoDB-聚合操作分类"><a href="#2-3-2-MongoDB-聚合操作分类" class="headerlink" title="2.3.2 MongoDB 聚合操作分类"></a>2.3.2 MongoDB 聚合操作分类</h3><ul>
<li>单目的聚合操作(Single Purpose Aggregation Operation) </li>
<li>聚合管道(Aggregation Pipeline) </li>
<li>MapReduce 编程模型 </li>
</ul>
<h3 id="2-3-3-单目的聚合操作"><a href="#2-3-3-单目的聚合操作" class="headerlink" title="2.3.3 单目的聚合操作"></a>2.3.3 单目的聚合操作</h3><p>单目的聚合命令常用的有：count() 和 distinct()</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.lg_resume_preview.find(&#123;&#125;).count()</span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-聚合管道-Aggregation-Pipeline"><a href="#2-3-4-聚合管道-Aggregation-Pipeline" class="headerlink" title="2.3.4 聚合管道(Aggregation Pipeline)"></a>2.3.4 聚合管道(Aggregation Pipeline)</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION) </span><br><span class="line">如: </span><br><span class="line">db.lg_resume_preview.aggregate([&#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$city</span>&quot;</span>,city_count:&#123;<span class="variable">$sum</span>:1&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure>
<p>MongoDB中聚合(aggregate)主要用于统计数据(诸如统计平均值,求和等)，并返回计算后的数据结果。<br>表达式：处理输入文档并输出。表达式只能用于计算当前聚合管道的文档，不能处理其它的文档。 </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041404008.png" alt="image-20220104140419937"></p>
<p>MongoDB 中使用 db.COLLECTION_NAME.aggregate([{},…]) 方法来构建和使用聚合管道，每个文档通过一个由一个或者多个阶段（stage）组成的管道，经过一系列的处理，输出相应的结果。<br>MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。<br>这里我们介绍一下聚合框架中常用的几个操作：</p>
<ul>
<li>$group：将集合中的文档分组，可用于统计结果。 </li>
<li>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及 嵌套文档。 </li>
<li>$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。 </li>
<li>$limit：用来限制MongoDB聚合管道返回的文档数。 </li>
<li>$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。 </li>
<li>$sort：将输入文档排序后输出。 </li>
<li>$geoNear：输出接近某一地理位置的有序文档。</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.lg_resume_preview.aggregate([&#123;$group : &#123;_id: <span class="string">&quot;$city&quot;</span>, avgSal:&#123;$avg:<span class="string">&quot;$expectSalary&quot;</span>&#125;&#125;&#125;, &#123;$project : &#123;city: <span class="string">&quot;$city&quot;</span>, salary : <span class="string">&quot;$avgSal&quot;</span>&#125;&#125;])</span><br><span class="line">db.lg_resume_preview.aggregate([&#123;$group:&#123;_id: <span class="string">&quot;$city&quot;</span>,count:&#123;$sum : <span class="number">1</span>&#125;&#125;&#125;, &#123;$match:&#123;count:&#123;$gt:<span class="number">1</span>&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure>


<h3 id="2-3-5-MapReduce-编程模型"><a href="#2-3-5-MapReduce-编程模型" class="headerlink" title="2.3.5 MapReduce 编程模型"></a>2.3.5 MapReduce 编程模型</h3><p>Pipeline查询速度快于MapReduce，但是MapReduce的强大之处在于能够在多台Server上并行执行复杂的聚合逻辑。MongoDB不允许Pipeline的单个聚合操作占用过多的系统内存，如果一个聚合操作消耗20%以上的内存，那么MongoDB直接停止操作，并向客户端输出错误消息。<br>MapReduce是一种计算模型，简单的说就是将大批量的工作（数据）分解（MAP）执行，然后再将结果合并成最终结果（REDUCE）。 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&gt;db.collection.mapReduce(</span><br><span class="line">  function() &#123;emit(key,value);&#125;, <span class="comment">//map 函数</span></span><br><span class="line">  function(key,values) &#123;return reduceFunction&#125;, <span class="comment">//reduce 函数</span></span><br><span class="line">  &#123; </span><br><span class="line">    out: collection, </span><br><span class="line">    query: document,</span><br><span class="line">    sort: document, </span><br><span class="line">    limit: number,</span><br><span class="line">    finalize: &lt;function&gt;, verbose: &lt;boolean&gt; </span><br><span class="line">  &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>使用 MapReduce 要实现两个函数 Map 函数和 Reduce 函数,Map 函数调用 emit(key, value), 遍历collection 中所有的记录, 将 key 与 value 传递给 Reduce 函数进行处理。<br>**参数说明： **</p>
<ul>
<li>map：是JavaScript 函数，负责将每一个输入文档转换为零或多个文档，生成键值对序列,作为 reduce 函数参数 </li>
<li>reduce：是JavaScript 函数，对map操作的输出做合并的化简的操作（将key-value变成key-values，也就是把values数组变成一个单一的值value） </li>
<li>out：统计结果存放集合 </li>
<li>query： 一个筛选条件，只有满足条件的文档才会调用map函数。 </li>
<li>sort： 和limit结合的sort排序参数（也是在发往map函数前给文档排序），可以优化分组机制 </li>
<li>limit： 发往map函数的文档数量的上限（要是没有limit，单独使用sort的用处不大） </li>
<li>finalize：可以对reduce输出结果再一次修改 </li>
<li>verbose：是否包括结果信息中的时间信息，默认为fasle <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.lg_resume_preview.mapReduce( </span><br><span class="line">  function() &#123; emit(this.city,this.expectSalary); &#125;, </span><br><span class="line">  function(key, value) &#123;return Array.avg(value)&#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    query:&#123;expectSalary:&#123;$gt: <span class="number">15000</span>&#125;&#125;, </span><br><span class="line">    out:<span class="string">&quot;cityAvgSal&quot;</span> </span><br><span class="line">  &#125; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="3-MongoDB索引Index"><a href="#3-MongoDB索引Index" class="headerlink" title="3. MongoDB索引Index"></a>3. MongoDB索引Index</h1><h2 id="3-1-什么是索引"><a href="#3-1-什么是索引" class="headerlink" title="3.1 什么是索引"></a>3.1 什么是索引</h2>索引是一种单独的、物理的对数据库表中一列或多列的值进行排序的一种存储结构，它是某个表中一列或若干列值的集合和相应的指向表中物理标识这些值的数据页的逻辑指针清单。索引的作用相当于图书的目录，可以根据目录中的页码快速找到所需的内容。索引目标是提高数据库的查询效率，没有索引的话，查询会进行全表扫描（scan every document in a collection）,数据量大时严重降低了查询效率。默认情况下Mongo在一个集合（collection）创建时，自动地对集合的_id创建了唯一索引。 </li>
</ul>
<h2 id="3-2-索引类型"><a href="#3-2-索引类型" class="headerlink" title="3.2 索引类型"></a>3.2 索引类型</h2><h3 id="3-2-1-单键索引-Single-Field"><a href="#3-2-1-单键索引-Single-Field" class="headerlink" title="3.2.1 单键索引 (Single Field)"></a>3.2.1 单键索引 (Single Field)</h3><p> MongoDB支持所有数据类型中的单个字段索引，并且可以在文档的任何字段上定义。<br>对于单个字段索引，索引键的排序顺序无关紧要，因为MongoDB可以在任一方向读取索引。<br>单个例上创建索引：<br> db.集合名.createIndex({“字段名”:排序方式})<br>**特殊的单键索引 过期索引 TTL （ Time To Live） **<br> TTL索引是MongoDB中一种特殊的索引， 可以支持文档在一定时间之后自动过期删除，目前TTL索引只能在单字段上建立，并且字段类型必须是日期类型。 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.集合名.createIndex(&#123;<span class="attr">&quot;日期字段&quot;</span>:排序方式&#125;, &#123;expireAfterSeconds: 秒数&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-复合索引-Compound-Index）"><a href="#3-2-2-复合索引-Compound-Index）" class="headerlink" title="3.2.2 复合索引(Compound Index）"></a>3.2.2 复合索引(Compound Index）</h3><p>通常我们需要在多个字段的基础上搜索表/集合，这是非常频繁的。 如果是这种情况，我们可能会考虑在MongoDB中制作复合索引。 复合索引支持基于多个字段的索引，这扩展了索引的概念并将它们扩展到索引中的更大域。<br>制作复合索引时要注意的重要事项包括：字段顺序与索引方向。 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.集合名.createIndex( &#123; <span class="attr">&quot;字段名1&quot;</span> : 排序方式, <span class="attr">&quot;字段名2&quot;</span> : 排序方式 &#125; )</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-多键索引（Multikey-indexes）"><a href="#3-2-3-多键索引（Multikey-indexes）" class="headerlink" title="3.2.3 多键索引（Multikey indexes）"></a>3.2.3 多键索引（Multikey indexes）</h3><p>针对属性包含数组数据的情况，MongoDB支持针对数组中每一个element创建索引，Multikey indexes支持strings，numbers和nested documents </p>
<h3 id="3-2-4-地理空间索引（Geospatial-Index）"><a href="#3-2-4-地理空间索引（Geospatial-Index）" class="headerlink" title="3.2.4 地理空间索引（Geospatial Index）"></a>3.2.4 地理空间索引（Geospatial Index）</h3><p>针对地理空间坐标数据创建索引。<br> 2dsphere索引，用于存储和查找球面上的点<br> 2d索引，用于存储和查找平面上的点</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.company.insert( </span><br><span class="line">  &#123; </span><br><span class="line">    loc : &#123; type: <span class="string">&quot;Point&quot;</span>, coordinates: [ <span class="number">116.482451</span>, <span class="number">39.914176</span> ] &#125;,</span><br><span class="line">    name: <span class="string">&quot;大望路地铁&quot;</span>, category : <span class="string">&quot;Parks&quot;</span> </span><br><span class="line">  &#125; </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db.company.ensureIndex( &#123; loc : <span class="string">&quot;2dsphere&quot;</span> &#125; ) 参数不是<span class="number">1</span>或<span class="number">-1</span>，为<span class="number">2</span>dsphere 或者 <span class="number">2</span>d。还可以建立组合索引。</span><br><span class="line">db.company.find(&#123; </span><br><span class="line">  <span class="attr">&quot;loc&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;$geoWithin&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;$center&quot;</span>:[[<span class="number">116.482451</span>,<span class="number">39.914176</span>],<span class="number">0.05</span>]</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 计算中心点最近的三个点 */</span></span><br><span class="line">db.company.aggregate([</span><br><span class="line">   &#123;</span><br><span class="line">     $geoNear: &#123;</span><br><span class="line">        near: &#123; type: <span class="string">&quot;Point&quot;</span>, coordinates: [<span class="number">116.482451</span>,<span class="number">39.914176</span> ] &#125;,</span><br><span class="line">        key: <span class="string">&quot;loc&quot;</span>,</span><br><span class="line">        distanceField: <span class="string">&quot;dist.calculated&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123; $limit: <span class="number">3</span> &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 2d 测试  */</span></span><br><span class="line">db.places.drop()</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple1&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">32</span>, <span class="number">22</span>]&#125;)</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple2&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">30</span>, <span class="number">22</span>]&#125;)</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple3&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">28</span>, <span class="number">21</span>]&#125;)</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple4&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">34</span>, <span class="number">27</span>]&#125;)</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple5&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">34</span>, <span class="number">26</span>]&#125;)</span><br><span class="line">db.places.insert(&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Temple6&quot;</span>,<span class="attr">&quot;tile&quot;</span>: [<span class="number">39</span>, <span class="number">28</span>]&#125;)</span><br><span class="line"></span><br><span class="line">db.places.find(&#123;&#125;)</span><br><span class="line"> </span><br><span class="line">db.places.ensureIndex(&#123;<span class="attr">&quot;tile&quot;</span> : <span class="string">&quot;2d&quot;</span>&#125;, &#123;<span class="attr">&quot;min&quot;</span> : <span class="number">-90</span>, <span class="attr">&quot;max&quot;</span> : <span class="number">90</span>, <span class="attr">&quot;bits&quot;</span> : <span class="number">20</span>&#125;) </span><br><span class="line"> </span><br><span class="line">db.places.find(&#123;<span class="attr">&quot;tile&quot;</span>: &#123;<span class="attr">&quot;$within&quot;</span>: &#123;<span class="attr">&quot;$box&quot;</span>: [[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">30</span>, <span class="number">30</span>]]&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-5-全文索引"><a href="#3-2-5-全文索引" class="headerlink" title="3.2.5 全文索引"></a>3.2.5 全文索引</h3><p>MongoDB提供了针对string内容的文本查询，Text Index支持任意属性值为string或string数组元素的索引查询。注意：一个集合仅支持最多一个Text Index，中文分词不理想 推荐ES。 </p>
<ul>
<li>db.集合.createIndex({“字段”: “text”}) </li>
<li>db.集合.find({“$text”: {“$search”: “coffee”}})</li>
</ul>
<h3 id="3-2-6-哈希索引-Hashed-Index"><a href="#3-2-6-哈希索引-Hashed-Index" class="headerlink" title="3.2.6 哈希索引 Hashed Index"></a>3.2.6 哈希索引 Hashed Index</h3><p>针对属性的哈希值进行索引查询，当要使用Hashed index时，MongoDB能够自动的计算hash值，无需程序计算hash值。注：hash index仅支持等于查询，不支持范围查询。 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.集合.createIndex(&#123;<span class="attr">&quot;字段&quot;</span>: <span class="string">&quot;hashed&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="3-3-索引和explain-分析"><a href="#3-3-索引和explain-分析" class="headerlink" title="3.3 索引和explain 分析"></a>3.3 索引和explain 分析</h2><h3 id="3-3-1-索引管理"><a href="#3-3-1-索引管理" class="headerlink" title="3.3.1 索引管理"></a>3.3.1 索引管理</h3><p>创建索引并在后台运行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.createIndex(&#123;<span class="attr">&quot;字段&quot;</span>:排序方式&#125;, &#123;background: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>获取针对某个集合的索引</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.getIndexes()</span><br></pre></td></tr></table></figure>
<p>索引的大小 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.totalIndexSize()</span><br></pre></td></tr></table></figure>
<p>索引的重建 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.reIndex()</span><br></pre></td></tr></table></figure>
<p>索引的删除 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">db.COLLECTION_NAME.dropIndex(<span class="string">&quot;INDEX-NAME&quot;</span>) </span><br><span class="line">db.COLLECTION_NAME.dropIndexes() </span><br><span class="line">注意: _id 对应的索引是删除不了的</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-explain-分析"><a href="#3-3-2-explain-分析" class="headerlink" title="3.3.2 explain 分析"></a>3.3.2 explain 分析</h3><p>使用js循环 插入100万条数据 不使用索引字段 查询查看执行计划 ，然后给某个字段建立索引,使用索引字段作为查询条件再查看执行计划进行分析</p>
<p>explain()也接收不同的参数，通过设置不同参数我们可以查看更详细的查询计划。 </p>
<ul>
<li><strong>queryPlanner：</strong>queryPlanner是默认参数，具体执行计划信息参考下面的表格。 </li>
<li><strong>executionStats</strong>：executionStats会返回执行计划的一些统计信息(有些版本中和 allPlansExecution等同)。 </li>
<li><strong>allPlansExecution</strong>:allPlansExecution用来获取所有执行计划，结果参数基本与上文相同。 </li>
</ul>
<p><strong>1、queryPlanner 默认参数</strong></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041405198.png" alt="image-20220104140534135"></p>
<p><strong>2、executionStats参数</strong></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041406081.png" alt="image-20220104140600038"></p>
<p>**3、executionStats返回逐层分析 **<br>第一层，executionTimeMillis最为直观explain返回值是executionTimeMillis值，指的是这条语句的执行时间，这个值当然是希望越少越好。<br>其中有3个executionTimeMillis，分别是： </p>
<ul>
<li>executionStats.executionTimeMillis 该query的整体查询时间。 </li>
<li>executionStats.executionStages.executionTimeMillisEstimate 该查询检索document获得数据的时间。 </li>
<li>executionStats.executionStages.inputStage.executionTimeMillisEstimate 该查询扫描文档 index所用时间。 </li>
</ul>
<p>第二层，index与document扫描数与查询返回条目数 这个主要讨论3个返回项 nReturned、 totalKeysExamined、totalDocsExamined，分别代表该条查询返回的条目、索引扫描条目、文档扫描 条目。 这些都是直观地影响到executionTimeMillis，我们需要扫描的越少速度越快。 对于一个查询， </p>
<p>我们最理想的状态是：nReturned=totalKeysExamined=totalDocsExamined </p>
<p>第三层，stage状态分析 那么又是什么影响到了totalKeysExamined和totalDocsExamined？是stage的类型。<br>类型列举如下： </p>
<ul>
<li>COLLSCAN：全表扫描 </li>
<li> IXSCAN：索引扫描 </li>
<li> FETCH：根据索引去检索指定document </li>
<li> SHARD_MERGE：将各个分片返回数据进行merge </li>
<li> SORT：表明在内存中进行了排序 </li>
<li> LIMIT：使用limit限制返回数 </li>
<li> SKIP：使用skip进行跳过 </li>
<li> IDHACK：针对_id进行查询 </li>
<li> SHARDING_FILTER：通过mongos对分片数据进行查询 </li>
<li> COUNT：利用db.coll.explain().count()之类进行count运算 </li>
<li> TEXT：使用全文索引进行查询时候的stage返回 </li>
<li> PROJECTION：限定返回字段时候stage的返回 </li>
</ul>
<p>对于普通查询，我希望看到stage的组合(查询的时候尽可能用上索引)： </p>
<ul>
<li>Fetch+IDHACK</li>
<li>Fetch+IXSCAN </li>
<li>Limit+（Fetch+IXSCAN） </li>
<li>PROJECTION+IXSCAN </li>
<li>SHARDING_FITER+IXSCAN </li>
<li>不希望看到包含如下的stage： </li>
<li>COLLSCAN(全表扫描) </li>
<li>SORT(使用sort但是无index) </li>
<li>COUNT 不使用index进行count) </li>
</ul>
<p>全表扫描：<code>db.lg_resume.find(&#123;name:&quot;test11011&quot;&#125;).explain(&quot;executionStats&quot;):</code></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041409376.png" alt="image.png"></p>
<p>索引检索：<br><code>db.lg_resume.createIndex(&#123;id:1&#125;)</code><br><code>db.lg_resume.find(&#123;id:&#123;$gt:678909&#125;&#125;).explain(&quot;executionStats&quot;)</code></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041410395.png" alt="image.png"></p>
<p><strong>4、allPlansExecution参数</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">queryPlanner 参数和executionStats的拼接</span><br></pre></td></tr></table></figure>
<h2 id="3-4-慢查询分析"><a href="#3-4-慢查询分析" class="headerlink" title="3.4 慢查询分析"></a>3.4 慢查询分析</h2><p>1.开启内置的查询分析器,记录读写操作效率<br>   db.setProfifilingLevel(n,m),n的取值可选0,1,2<br>      0表示不记录<br>      1表示记录慢速操作,如果值为1,m必须赋值单位为ms,用于定义慢速查询时间的阈值<br>      2表示记录所有的读写操作<br>2.查询监控结果<br>    db.system.profifile.fifind().sort({millis:-1}).limit(3)<br>3.分析慢速查询<br>    应用程序设计不合理、不正确的数据模型、硬件配置问题,缺少索引等<br>4.解读explain结果 确定是否缺少索引<br><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041411492.png" alt="image.png"></p>
<h2 id="3-5-MongoDB-索引底层实现原理分析"><a href="#3-5-MongoDB-索引底层实现原理分析" class="headerlink" title="3.5 MongoDB 索引底层实现原理分析"></a>3.5 MongoDB 索引底层实现原理分析</h2><p> MongoDB 是文档型的数据库，它使用BSON 格式保存数据，比关系型数据库存储更方便。比如之前关系型数据库中处理用户、订单等数据要建立对应的表，还要建立它们之间的关联关系。但是BSON就不一样了，我们可以把一条数据和这条数据对应的数据都存入一个BSON对象中,这种形式更简单，通俗易懂。MySql是关系型数据库，数据的关联性是非常强的，区间访问是常见的一种情况，底层索引组织数据使用B+树，B+树由于数据全部存储在叶子节点，并且通过指针串在一起，这样就很容易的进行区间遍历甚至全部遍历。MongoDB使用B-树，所有节点都有Data域，只要找到指定索引就可以进行访问，单次查询从结构上来看要快于MySql。<br>B-树是一种自平衡的搜索树，形式很简单： </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041411898.png" alt="image-20220104141132846"></p>
<p>B-树的特点:<br>(1) 多路 非二叉树 。<br>(2) 每个节点 既保存数据 又保存索引 。<br>(3) 搜索时 相当于二分查找 。<br>B+树是B-树的变种 。</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041411964.png" alt="image-20220104141158914"></p>
<p> B+ 树的特点:<br>（1） 多路非二叉 。<br>（2） 只有叶子节点保存数据 。<br>（3） 搜索时 也相当于二分查找 。<br>（4） 增加了 相邻节点指针。<br>从上面我们可以看出最核心的区别主要有俩，一个是数据的保存位置，一个是相邻节点的指向。就是这俩造成了MongoDB和MySql的差别。<br>（1）B+树相邻接点的指针可以大大增加区间访问性，可使用在范围查询等，而B-树每个节点 key 和 data 在一起 适合随机读写 ，而区间查找效率很差。<br>（2）B+树更适合外部存储，也就是磁盘存储，使用B-结构的话，每次磁盘预读中的很多数据是用不上的数据。因此，它没能利用好磁盘预读的提供的数据。由于节点内无 data 域，每个节点能索引的范围更大更精确。<br>（3）注意这个区别相当重要，是基于（1）（2)的，B-树每个节点即保存数据又保存索引 树的深度小，所以磁盘IO的次数很少，B+树只有叶子节点保存，较B树而言深度大磁盘IO多，但是区间访问比较好。</p>
<h1 id="4-MongoDB-应用实战"><a href="#4-MongoDB-应用实战" class="headerlink" title="4. MongoDB 应用实战"></a>4. MongoDB 应用实战</h1><h2 id="4-1-MongoDB的适用场景"><a href="#4-1-MongoDB的适用场景" class="headerlink" title="4.1 MongoDB的适用场景"></a>4.1 MongoDB的适用场景</h2><ul>
<li>网站数据：Mongo 非常适合实时的插入,更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性。</li>
<li>缓存：由于性能很高，Mongo 也适合作为信息基础设施的缓存层。在系统重启之后，由Mongo搭建的持久化缓存层可以避免下层的数据源过载。</li>
<li>大尺寸、低价值的数据：使用传统的关系型数据库存储一些大尺寸低价值数据时会比较浪费，在此之前，很多时候程序员往往会选择传统的文件进行存储。</li>
<li>高伸缩性的场景：Mongo 非常适合由数十或数百台服务器组成的数据库，Mongo 的路线图中已经包含对MapReduce 引擎的内置支持以及集群高可用的解决方案。</li>
<li>用于对象及JSON 数据的存储：Mongo 的BSON 数据格式非常适合文档化格式的存储及查询。</li>
</ul>
<h2 id="4-2-MongoDB的行业具体应用场景"><a href="#4-2-MongoDB的行业具体应用场景" class="headerlink" title="4.2 MongoDB的行业具体应用场景"></a>4.2 MongoDB的行业具体应用场景</h2><ul>
<li>游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、更新。 </li>
<li>物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来。 </li>
<li>社交场景，使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。 </li>
<li>物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。 </li>
<li>直播，使用 MongoDB 存储用户信息、礼物信息等。 </li>
</ul>
<h2 id="4-3-如何抉择是否使用MongoDB"><a href="#4-3-如何抉择是否使用MongoDB" class="headerlink" title="4.3 如何抉择是否使用MongoDB"></a>4.3 如何抉择是否使用MongoDB</h2><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202201041413864.png" alt="image.png"></p>
<h2 id="4-4-Java-访问MongoDB"><a href="#4-4-Java-访问MongoDB" class="headerlink" title="4.4 Java 访问MongoDB"></a>4.4 Java 访问MongoDB</h2><p>maven 依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo-java-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>文档添加 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.FindIterable;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.model.Filters;</span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MongoClient mongoClient = <span class="keyword">new</span> MongoClient(<span class="string">&quot;106.75.226.220&quot;</span>, <span class="number">28017</span>);</span><br><span class="line">        <span class="keyword">final</span> MongoDatabase mongoDatabase = mongoClient.getDatabase(<span class="string">&quot;lg_resume&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> MongoCollection&lt;Document&gt; collection = mongoDatabase.getCollection(<span class="string">&quot;lg_resume&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> Document document = Document.parse(<span class="string">&quot;&#123;id:9999999,name:&#x27;text1&#x27;,salary:99999&#125;&quot;</span>);</span><br><span class="line">        <span class="comment">//collection.insertOne(document);</span></span><br><span class="line"></span><br><span class="line">        Document sdoc=<span class="keyword">new</span> Document();</span><br><span class="line">        <span class="comment">//按expectSalary倒序</span></span><br><span class="line">        sdoc.append(<span class="string">&quot;salary&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">final</span> FindIterable&lt;Document&gt; documents = collection.find(Document.parse(<span class="string">&quot;&#123;id:&#123;$gt:999000&#125;&#125;&quot;</span>)).sort(sdoc);</span><br><span class="line">        FindIterable&lt;Document&gt; findIterable = collection.find(Filters.gt(<span class="string">&quot;salary&quot;</span>,<span class="number">21000</span>)).sort(sdoc);</span><br><span class="line">        <span class="keyword">for</span> (Document doc : documents)&#123;</span><br><span class="line">            System.out.println(doc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mongoClient.close();</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="4-5-Spring-访问MongoDB"><a href="#4-5-Spring-访问MongoDB" class="headerlink" title="4.5 Spring 访问MongoDB"></a>4.5 Spring 访问MongoDB</h2><p>第1步：基于maven新建工程导入依赖的包 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">2.0</span><span class="number">.9</span>.RELEASE&lt;/version&gt; </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>第2步:在配置文件中配置 MongoTemplate </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:mongo=<span class="string">&quot;http://www.springframework.org/schema/data/mongo&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot; http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/data/mongo</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/data/mongo/spring-mongo.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mongo:db-factory id=<span class="string">&quot;mongoDbFactory&quot;</span> client-uri=<span class="string">&quot;mongodb://106.75.226.220:28017/lg_resume&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;mongoTemplate&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;0&quot;</span> ref=<span class="string">&quot;mongoDbFactory&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;org.example.mongodb&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>第3步:DAO 实现类注入 MongoTemplate 完成增删改查</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：xjlonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2021/5/13 15:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resume</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(<span class="keyword">double</span> salary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Resume&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, salary=&quot;</span> + salary +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.dao.ResumeDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：xjlonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2021/5/13 15:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(value = &quot;resumeDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResumeDaoImpl</span> <span class="keyword">implements</span> <span class="title">ResumeDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate  mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertResume</span><span class="params">(Resume resume)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不指定collection时  默认为对象名首字母小写</span></span><br><span class="line">        <span class="comment">//mongoTemplate.insert(resume);</span></span><br><span class="line">        <span class="comment">//指定collection</span></span><br><span class="line">        mongoTemplate.insert(resume,<span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Resume&gt; <span class="title">findByResume</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query();</span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;name&quot;</span>).is(name));</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query,Resume.class, <span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Resume&gt; <span class="title">findByNameAndSalary</span><span class="params">(String name, <span class="keyword">double</span> salary)</span> </span>&#123;</span><br><span class="line">        Query query  =<span class="keyword">new</span> Query();</span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;name&quot;</span>).is(name).andOperator(Criteria.where(<span class="string">&quot;salary&quot;</span>).is(salary)));</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query, Resume.class,<span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第4步: 从Spring容器中获取DAO对象 进行测试 (注意:要开启组件扫描) </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.dao.ResumeDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.datetime.DateFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext pathXmlApplicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> ResumeDao resumeDao = pathXmlApplicationContext.getBean(<span class="string">&quot;resumeDao&quot;</span>, ResumeDao.class);</span><br><span class="line">        Resume resume = <span class="keyword">new</span> Resume();</span><br><span class="line">        resume.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        resume.setSalary(<span class="number">895555</span>);</span><br><span class="line">        <span class="comment">//日期格式</span></span><br><span class="line">        Date date = <span class="keyword">null</span>;</span><br><span class="line">        SimpleDateFormat dateFormatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date =  dateFormatter.parse(<span class="string">&quot;2001-2-12 13:12:23&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        resume.setBirthday(date);</span><br><span class="line">        resumeDao.insertResume(resume);</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="4-6-Spring-Boot-访问-MongoDB"><a href="#4-6-Spring-Boot-访问-MongoDB" class="headerlink" title="4.6 Spring Boot 访问 MongoDB"></a>4.6 Spring Boot 访问 MongoDB</h2><h3 id="4-6-1-MongoTemplate-的方式"><a href="#4-6-1-MongoTemplate-的方式" class="headerlink" title="4.6.1 MongoTemplate 的方式"></a>4.6.1 MongoTemplate 的方式</h3><p>第1步：基于maven新建springboot工程 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo-spring-boot-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mongo-spring-boot-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- FIXME change it to the project&#x27;s website --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.22.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-install-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-site-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-project-info-reports-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第2步: 配置文件application.properties </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">spring.data.mongodb.host=106.75.226.220</span><br><span class="line">spring.data.mongodb.port=28017</span><br><span class="line">spring.data.mongodb.database=lg_resume</span><br></pre></td></tr></table></figure>
<p>第3步: DAO 实现类 注入 MongoTemplate 完成增删改查 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.dao.ResumeDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：xjlonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2021/5/13 15:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(value = &quot;resumeDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResumeDaoImpl</span> <span class="keyword">implements</span> <span class="title">ResumeDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate  mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertResume</span><span class="params">(Resume resume)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不指定collection时  默认为对象名首字母小写</span></span><br><span class="line">        <span class="comment">//mongoTemplate.insert(resume);</span></span><br><span class="line">        <span class="comment">//指定collection</span></span><br><span class="line">        mongoTemplate.insert(resume,<span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Resume&gt; <span class="title">findByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query();</span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;name&quot;</span>).is(name));</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query,Resume.class, <span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Resume&gt; <span class="title">findByNameAndSalary</span><span class="params">(String name, <span class="keyword">double</span> salary)</span> </span>&#123;</span><br><span class="line">        Query query  =<span class="keyword">new</span> Query();</span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;name&quot;</span>).is(name).andOperator(Criteria.where(<span class="string">&quot;salary&quot;</span>).is(salary)));</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query, Resume.class,<span class="string">&quot;lg_resume_datas&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第4步: 从Spring容器中获取DAO对象 进行测试 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.dao.ResumeDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ApplicationContext applicationContext = SpringApplication.run(App.class,args);</span><br><span class="line">        <span class="keyword">final</span> ResumeDao resumeDao = applicationContext.getBean(<span class="string">&quot;resumeDao&quot;</span>, ResumeDao.class);</span><br><span class="line">        Resume resume = <span class="keyword">new</span> Resume();</span><br><span class="line">        resume.setId(<span class="number">199233</span>);</span><br><span class="line">        <span class="comment">//多长插入数据 不想重复 可以设置字段索引唯一性约束</span></span><br><span class="line">        resume.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        resume.setSalary(<span class="number">895555</span>);</span><br><span class="line">        <span class="comment">//日期格式</span></span><br><span class="line">        Date date = <span class="keyword">null</span>;</span><br><span class="line">        SimpleDateFormat dateFormatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date =  dateFormatter.parse(<span class="string">&quot;2001-2-12 13:12:23&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        resume.setBirthday(date);</span><br><span class="line">        resumeDao.insertResume(resume);</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>**4.6.2 MongoRepository 的方式 **<br>第1步：基于maven新建springboot工程</p>
<p>第2步: 配置文件application.properties 以上两步同上小节</p>
<p>第3步:编写实体类并在实体类上打@Document(“集合名”) </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：xjlonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2021/5/13 15:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Document(&quot;lg_resume_datas&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resume</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(<span class="keyword">double</span> salary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Resume&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, salary=&quot;</span> + salary +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第4步:编写 Repository 接口 继承 MongoRepository<br>方法具体参考:<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation">https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation</a><br>如果内置方法不够用 就自己定义 如:定义find|read|get 等开头的方法进行查询</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：xjlonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2021/5/13 15:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResumeRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Resume</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第5步: 从Spring容器中获取Repository对象 进行测试 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.mongodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.bean.Resume;</span><br><span class="line"><span class="keyword">import</span> org.example.mongodb.dao.ResumeRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ApplicationContext applicationContext = SpringApplication.run(App.class,args);</span><br><span class="line">        <span class="keyword">final</span> ResumeRepository resumeRepository = applicationContext.getBean(ResumeRepository.class);</span><br><span class="line">        <span class="keyword">final</span> List&lt;Resume&gt; all = resumeRepository.findAll();</span><br><span class="line">        all.forEach(x-&gt;&#123;</span><br><span class="line">            System.out.println(x.toString());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小肥龙吃大冰淇淋</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lvxueyang.vip/post/2c424ebd.html">http://lvxueyang.vip/post/2c424ebd.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lvxueyang.vip" target="_blank">小肥龙吃大冰淇淋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NoSQL/">NoSQL</a><a class="post-meta__tags" href="/tags/MongoDB/">MongoDB</a></div><div class="post_share"><div class="social-share" data-image="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/415f68f2.html"><img class="prev-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MongoDB安全认证</div></div></a></div><div class="next-post pull-right"><a href="/post/5a22146c.html"><img class="next-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MongoDB建模</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/5d593c3c.html" title="MongoDB架构"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">MongoDB架构</div></div></a></div><div><a href="/post/5a22146c.html" title="MongoDB建模"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">MongoDB建模</div></div></a></div><div><a href="/post/415f68f2.html" title="MongoDB安全认证"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">MongoDB安全认证</div></div></a></div><div><a href="/post/c32aa451.html" title="MongoDB集群高可用"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">MongoDB集群高可用</div></div></a></div><div><a href="/post/7d584b4.html" title="Neo4j高级应用"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">Neo4j高级应用</div></div></a></div><div><a href="/post/e0e0581e.html" title="图和Neo4j"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">图和Neo4j</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-MongoDB%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">1. MongoDB体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-NoSQL-%E5%92%8C-MongoDB"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 NoSQL 和 MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-MongoDB-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 MongoDB 体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-MongoDB-%E5%92%8CRDBMS-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 MongoDB 和RDBMS(关系型数据库)对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E4%BB%80%E4%B9%88%E6%98%AFBSON"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 什么是BSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-BSON%E5%9C%A8MongoDB%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 BSON在MongoDB中的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-MongoDB%E5%9C%A8Linux%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 MongoDB在Linux的安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-MongoDB%E5%90%AF%E5%8A%A8%E5%92%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.</span> <span class="toc-text">1.7 MongoDB启动和参数说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-mongo-shell-%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">1.8.</span> <span class="toc-text">1.8 mongo shell 的启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-9-Mongodb-GUI%E5%B7%A5%E5%85%B7"><span class="toc-number">1.9.</span> <span class="toc-text">1.9 Mongodb GUI工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-1-MongoDB-Compass-Community"><span class="toc-number">1.9.1.</span> <span class="toc-text">1.9.1 MongoDB Compass Community</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-2-NoSQLBooster%EF%BC%88mongobooster%EF%BC%89"><span class="toc-number">1.9.2.</span> <span class="toc-text">1.9.2 NoSQLBooster（mongobooster）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-MongoDB%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">2. MongoDB命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0"><span class="toc-number">2.0.1.</span> <span class="toc-text">2.2.1 数据添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.2.2 数据查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">2.0.3.</span> <span class="toc-text">2.2.3 数据更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4"><span class="toc-number">2.0.4.</span> <span class="toc-text">2.2.4 数据删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-MongoDB-%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">2.3 MongoDB 聚合操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.3.1 聚合操作简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-MongoDB-%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.3.2 MongoDB 聚合操作分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E5%8D%95%E7%9B%AE%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.3.3 单目的聚合操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93-Aggregation-Pipeline"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.3.4 聚合管道(Aggregation Pipeline)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-MapReduce-%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.3.5 MapReduce 编程模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-MongoDB%E7%B4%A2%E5%BC%95Index"><span class="toc-number">3.</span> <span class="toc-text">3. MongoDB索引Index</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 什么是索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 索引类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%8D%95%E9%94%AE%E7%B4%A2%E5%BC%95-Single-Field"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 单键索引 (Single Field)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95-Compound-Index%EF%BC%89"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 复合索引(Compound Index）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E5%A4%9A%E9%94%AE%E7%B4%A2%E5%BC%95%EF%BC%88Multikey-indexes%EF%BC%89"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 多键索引（Multikey indexes）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%E7%B4%A2%E5%BC%95%EF%BC%88Geospatial-Index%EF%BC%89"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 地理空间索引（Geospatial Index）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 全文索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6-%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95-Hashed-Index"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.6 哈希索引 Hashed Index</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E7%B4%A2%E5%BC%95%E5%92%8Cexplain-%E5%88%86%E6%9E%90"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 索引和explain 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 索引管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-explain-%E5%88%86%E6%9E%90"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 explain 分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 慢查询分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-MongoDB-%E7%B4%A2%E5%BC%95%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 MongoDB 索引底层实现原理分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-MongoDB-%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98"><span class="toc-number">4.</span> <span class="toc-text">4. MongoDB 应用实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-MongoDB%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 MongoDB的适用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-MongoDB%E7%9A%84%E8%A1%8C%E4%B8%9A%E5%85%B7%E4%BD%93%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 MongoDB的行业具体应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%A6%82%E4%BD%95%E6%8A%89%E6%8B%A9%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8MongoDB"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 如何抉择是否使用MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Java-%E8%AE%BF%E9%97%AEMongoDB"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Java 访问MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-Spring-%E8%AE%BF%E9%97%AEMongoDB"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 Spring 访问MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-Spring-Boot-%E8%AE%BF%E9%97%AE-MongoDB"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 Spring Boot 访问 MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-1-MongoTemplate-%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">4.6.1.</span> <span class="toc-text">4.6.1 MongoTemplate 的方式</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 小肥龙吃大冰淇淋</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'pinglun-9gh2lmcnd8587831',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'pinglun-9gh2lmcnd8587831',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script src="//code.tidio.co/smwivpnwumemac2wohardi3d3gpud1ag.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>