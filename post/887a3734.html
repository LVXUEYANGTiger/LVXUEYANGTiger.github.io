<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>传智健康day03 | 小肥龙吃大冰淇淋</title><meta name="keywords" content="javase基础,传智健康"><meta name="author" content="小肥龙吃大冰淇淋"><meta name="copyright" content="小肥龙吃大冰淇淋"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第3章 预约管理-套餐管理学习目标：  了解常见的图片存储方案  掌握新增套餐实现过程  掌握套餐分页查询实现过程  掌握编辑套餐实现过程  掌握删除套餐实现过程   1. 图片存储方案【目标】传智健康项目，图片存储方案 【路径】1：介绍 （1）文件上传功能介绍  2：七牛云存储 （1）注册 （2）新建存储空间 （3）查看存储空间信息 （4）开发者中心  文件上传 文件删除  （5）鉴权 （6）J">
<meta property="og:type" content="article">
<meta property="og:title" content="传智健康day03">
<meta property="og:url" content="https://lvxueyangtiger.github.io/post/887a3734.html">
<meta property="og:site_name" content="小肥龙吃大冰淇淋">
<meta property="og:description" content="第3章 预约管理-套餐管理学习目标：  了解常见的图片存储方案  掌握新增套餐实现过程  掌握套餐分页查询实现过程  掌握编辑套餐实现过程  掌握删除套餐实现过程   1. 图片存储方案【目标】传智健康项目，图片存储方案 【路径】1：介绍 （1）文件上传功能介绍  2：七牛云存储 （1）注册 （2）新建存储空间 （3）查看存储空间信息 （4）开发者中心  文件上传 文件删除  （5）鉴权 （6）J">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082121.jpg">
<meta property="article:published_time" content="2021-12-08T07:27:00.000Z">
<meta property="article:modified_time" content="2022-11-27T09:16:44.148Z">
<meta property="article:author" content="小肥龙吃大冰淇淋">
<meta property="article:tag" content="javase基础">
<meta property="article:tag" content="传智健康">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082121.jpg"><link rel="shortcut icon" href="https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210805191028.png"><link rel="canonical" href="https://lvxueyangtiger.github.io/post/887a3734"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '传智健康day03',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:16:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/ali_icon.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mogai.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="小肥龙吃大冰淇淋" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">303</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">108</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">73</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082121.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小肥龙吃大冰淇淋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">传智健康day03</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-08T07:27:00.000Z" title="发表于 2021-12-08 15:27:00">2021-12-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T09:16:44.148Z" title="更新于 2022-11-27 17:16:44">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java%E5%AD%A6%E4%B9%A0/">java学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java%E5%AD%A6%E4%B9%A0/%E4%BC%A0%E6%99%BA%E5%81%A5%E5%BA%B7/">传智健康</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>52分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="传智健康day03"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第3章-预约管理-套餐管理"><a href="#第3章-预约管理-套餐管理" class="headerlink" title="第3章 预约管理-套餐管理"></a>第3章 预约管理-套餐管理</h1><p>学习目标：</p>
<ul>
<li><p>了解常见的图片存储方案</p>
</li>
<li><p>掌握新增套餐实现过程</p>
</li>
<li><p>掌握套餐分页查询实现过程</p>
</li>
<li><p>掌握编辑套餐实现过程</p>
</li>
<li><p>掌握删除套餐实现过程</p>
</li>
</ul>
<h1 id="1-图片存储方案"><a href="#1-图片存储方案" class="headerlink" title="1. 图片存储方案"></a>1. 图片存储方案</h1><h3 id="【目标】"><a href="#【目标】" class="headerlink" title="【目标】"></a>【目标】</h3><p>传智健康项目，图片存储方案</p>
<h3 id="【路径】"><a href="#【路径】" class="headerlink" title="【路径】"></a>【路径】</h3><p>1：介绍</p>
<p>（1）文件上传功能介绍 </p>
<p>2：七牛云存储</p>
<p>（1）注册</p>
<p>（2）新建存储空间</p>
<p>（3）查看存储空间信息</p>
<p>（4）开发者中心</p>
<ul>
<li>文件上传</li>
<li>文件删除</li>
</ul>
<p>（5）鉴权</p>
<p>（6）Java SDK操作七牛云</p>
<p>（7）封装工具类</p>
<h3 id="【讲解】"><a href="#【讲解】" class="headerlink" title="【讲解】"></a>【讲解】</h3><h2 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1. 介绍"></a>1.1. <strong>介绍</strong></h2><p>在实际开发中，我们会有很多处理不同功能的服务器。例如： </p>
<p>应用服务器：负责部署我们的应用 </p>
<p>数据库服务器：运行我们的数据库 </p>
<p>文件服务器：负责存储用户上传文件的服务器</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162732.png" alt="img"> </p>
<p>分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。 </p>
<p>常见的图片存储方案：</p>
<p>方案一：使用nginx搭建图片服务器</p>
<p>方案二：使用开源的分布式文件存储系统，例如Fastdfs==、HDFS等</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162733.png" alt="img"> </p>
<p>方案三：使用云存储，例如阿里云、==七牛云==等</p>
<h2 id="1-2-七牛云存储"><a href="#1-2-七牛云存储" class="headerlink" title="1.2. 七牛云存储"></a>1.2. <strong>七牛云存储</strong></h2><p>七牛云（隶属于上海七牛信息技术有限公司）是国内领先的以视觉智能和数据智能为核心的企业级云计算服务商，同时也是国内知名智能视频云服务商，累计为 70 多万家企业提供服务，覆盖了国内80%网民。围绕富媒体场景推出了==对象存储==、融合 CDN 加速、容器云、大数据平台、深度学习平台等产品、并提供一站式智能视频云解决方案。为各行业及应用提供可持续发展的智能视频云生态，帮助企业快速上云，创造更广阔的商业价值。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.qiniu.com/">https://www.qiniu.com/</a></p>
<p>通过七牛云官网介绍我们可以知道其提供了多种服务，==我们主要使用的是七牛云提供的对象存储服务来存储图片。==</p>
<h3 id="1-2-1-注册、登录"><a href="#1-2-1-注册、登录" class="headerlink" title="1.2.1. 注册、登录"></a>1.2.1. <strong>注册、登录</strong></h3><p>要使用七牛云的服务，首先需要注册成为会员。地址：<a target="_blank" rel="noopener" href="https://portal.qiniu.com/signup">https://portal.qiniu.com/signup</a></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162734.png" alt="img"> </p>
<p>注册完成后就可以使用刚刚注册的邮箱和密码登录到七牛云：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162735.png" alt="img"> </p>
<p>登录成功后点击页面右上角管理控制台：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162736.png" alt="img"> </p>
<p>==注意：登录成功后还需要进行实名认证才能进行相关操作。==</p>
<h3 id="1-2-2-新建存储空间"><a href="#1-2-2-新建存储空间" class="headerlink" title="1.2.2. 新建存储空间"></a>1.2.2. <strong>新建存储空间</strong></h3><p>要进行图片存储，我们需要在七牛云管理控制台新建存储空间。点击管理控制台首页对象存储下的立即添加按钮，页面跳转到新建存储空间页面：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162737.png" alt="img"> </p>
<p>可以创建多个存储空间，各个存储空间是相互独立的。</p>
<h3 id="1-2-3-查看存储空间信息"><a href="#1-2-3-查看存储空间信息" class="headerlink" title="1.2.3. 查看存储空间信息"></a>1.2.3. <strong>查看存储空间信息</strong></h3><p>存储空间创建后，会在左侧的存储空间列表菜单中展示创建的存储空间名称，点击存储空间名称可以查看当前存储空间的相关信息</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162738.png" alt="img"> </p>
<p>==课程中重点关注【内容管理】中的信息。==</p>
<h3 id="1-2-4-开发者中心"><a href="#1-2-4-开发者中心" class="headerlink" title="1.2.4. 开发者中心"></a>1.2.4. <strong>开发者中心</strong></h3><p>可以通过七牛云提供的开发者中心学习如何操作七牛云服务，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/">https://developer.qiniu.com/</a></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162739.png" alt="img"> </p>
<p>==点击对象存储==，跳转到对象存储开发页面，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo">https://developer.qiniu.com/kodo</a></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162740.png" alt="img"> </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162741.png" alt="img"> </p>
<p>操作步骤：</p>
<p>第一步：导入jar包：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162742.png" alt="img"> </p>
<p>第二步：鉴权</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162743.png" alt="img"> </p>
<p>点击“管理控制台”，点击右上图标</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162744.png" alt="img"> </p>
<p>可根据文档中提供的上传文件和删除文件进行测试：</p>
<p>在health_common中测试</p>
<h4 id="1-2-4-1-文件上传"><a href="#1-2-4-1-文件上传" class="headerlink" title="1.2.4.1.文件上传"></a>1.2.4.1.文件上传</h4><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162745.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestQiniu</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传本地文件</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">        Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone0());</span><br><span class="line">        <span class="comment">//...其他参数参考类注释</span></span><br><span class="line">        UploadManager uploadManager = <span class="keyword">new</span> UploadManager(cfg);</span><br><span class="line">        <span class="comment">//...生成上传凭证，然后准备上传</span></span><br><span class="line">        String accessKey = <span class="string">&quot;liyKTcQC5TP1LrhgZH6Xem8zqMXbEtVgfAINP53w&quot;</span>;</span><br><span class="line">        String secretKey = <span class="string">&quot;f5zpuzKAPceEMG77-EK3XbwqgOBRDXDawG4UHRtb&quot;</span>;</span><br><span class="line">        String bucket = <span class="string">&quot;itcast_health&quot;</span>;</span><br><span class="line">        <span class="comment">//如果是Windows情况下，格式是 D:\\qiniu\\test.png，可支持中文</span></span><br><span class="line">        String localFilePath = <span class="string">&quot;D:/2.jpg&quot;</span>;</span><br><span class="line">        <span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">        String key = <span class="keyword">null</span>;</span><br><span class="line">        Auth auth = Auth.create(accessKey, secretKey);</span><br><span class="line">        String upToken = auth.uploadToken(bucket);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Response response = uploadManager.put(localFilePath, key, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            System.out.println(putRet.key);</span><br><span class="line">            System.out.println(putRet.hash);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            Response r = ex.response;</span><br><span class="line">            System.err.println(r.toString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(r.bodyString());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                <span class="comment">//ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-2-文件删除"><a href="#1-2-4-2-文件删除" class="headerlink" title="1.2.4.2.文件删除"></a>1.2.4.2.文件删除</h4><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162746.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除空间中的文件</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">    Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone0());</span><br><span class="line">    <span class="comment">//...其他参数参考类注释</span></span><br><span class="line">    String accessKey = <span class="string">&quot;liyKTcQC5TP1LrhgZH6Xem8zqMXbEtVgfAINP53w&quot;</span>;</span><br><span class="line">    String secretKey = <span class="string">&quot;f5zpuzKAPceEMG77-EK3XbwqgOBRDXDawG4UHRtb&quot;</span>;</span><br><span class="line">    String bucket = <span class="string">&quot;itcast_health&quot;</span>;</span><br><span class="line">    String key = <span class="string">&quot;Fu3Ic6TV6wIbJt793yaGeBmCkzTX&quot;</span>;</span><br><span class="line">    Auth auth = Auth.create(accessKey, secretKey);</span><br><span class="line">    BucketManager bucketManager = <span class="keyword">new</span> BucketManager(auth, cfg);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        bucketManager.delete(bucket, key);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">        <span class="comment">//如果遇到异常，说明删除失败</span></span><br><span class="line">        System.err.println(ex.code());</span><br><span class="line">        System.err.println(ex.response.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 七牛云提供了多种方式操作对象存储服务，本项目采用Java SDK方式，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo/sdk/1239/java">https://developer.qiniu.com/kodo/sdk/1239/java</a></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162747.png" alt="img"> </p>
<p>使用Java SDK操作七牛云需要导入如下maven坐标：（项目已经引入）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-5-鉴权"><a href="#1-2-5-鉴权" class="headerlink" title="1.2.5. 鉴权"></a>1.2.5. <strong>鉴权</strong></h3><p>Java SDK的所有的功能，都需要合法的授权。授权凭证的签算需要七牛账号下的一对==有效的Access Key和Secret Key==，这对密钥可以在七牛云管理控制台的个人中心（<a target="_blank" rel="noopener" href="https://portal.qiniu.com/user/key">https://portal.qiniu.com/user/key</a>）获得，如下图：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162748.png" alt="img"> </p>
<h3 id="1-2-6-Java-SDK操作七牛云"><a href="#1-2-6-Java-SDK操作七牛云" class="headerlink" title="1.2.6. Java SDK操作七牛云"></a>1.2.6. <strong>Java SDK操作七牛云</strong></h3><p>本章节我们就需要使用七牛云提供的Java SDK完成图片上传和删除，我们可以参考官方提供的例子。</p>
<p>==上传文件==：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//构造一个带指定Zone对象的配置类，zone0表示华东地区（默认）</span></span><br><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone0());</span><br><span class="line"><span class="comment">//...其他参数参考类注释</span></span><br><span class="line"></span><br><span class="line">UploadManager uploadManager = <span class="keyword">new</span> UploadManager(cfg);</span><br><span class="line"><span class="comment">//...生成上传凭证，然后准备上传</span></span><br><span class="line">String accessKey = <span class="string">&quot;your access key&quot;</span>;</span><br><span class="line">String secretKey = <span class="string">&quot;your secret key&quot;</span>;</span><br><span class="line">String bucket = <span class="string">&quot;your bucket name&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">String key = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] uploadBytes = <span class="string">&quot;hello qiniu cloud&quot;</span>.getBytes(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    ByteArrayInputStream byteInputStream=<span class="keyword">new</span> ByteArrayInputStream(uploadBytes);</span><br><span class="line">    Auth auth = Auth.create(accessKey, secretKey);</span><br><span class="line">    String upToken = auth.uploadToken(bucket);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Response response = uploadManager.put(byteInputStream,key,upToken,<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//解析上传成功的结果</span></span><br><span class="line">        DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">        System.out.println(putRet.key);</span><br><span class="line">        System.out.println(putRet.hash);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">        Response r = ex.response;</span><br><span class="line">        System.err.println(r.toString());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.err.println(r.bodyString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException ex) &#123;</span><br><span class="line">    <span class="comment">//ignore</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>==删除文件==：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//构造一个带指定Zone对象的配置类，zone0表示华东地区（默认）</span></span><br><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone0());</span><br><span class="line"><span class="comment">//...其他参数参考类注释</span></span><br><span class="line"></span><br><span class="line">String accessKey = <span class="string">&quot;your access key&quot;</span>;</span><br><span class="line">String secretKey = <span class="string">&quot;your secret key&quot;</span>;</span><br><span class="line"></span><br><span class="line">String bucket = <span class="string">&quot;your bucket name&quot;</span>;</span><br><span class="line">String key = <span class="string">&quot;your file key&quot;</span>;</span><br><span class="line"></span><br><span class="line">Auth auth = Auth.create(accessKey, secretKey);</span><br><span class="line">BucketManager bucketManager = <span class="keyword">new</span> BucketManager(auth, cfg);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    bucketManager.delete(bucket, key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">    <span class="comment">//如果遇到异常，说明删除失败</span></span><br><span class="line">    System.err.println(ex.code());</span><br><span class="line">    System.err.println(ex.response.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-7-封装工具类"><a href="#1-2-7-封装工具类" class="headerlink" title="1.2.7. 封装工具类"></a>1.2.7. <strong>封装工具类</strong></h3><p>为了方便操作七牛云存储服务，我们可以将官方提供的案例简单改造成一个工具类，在我们的项目中直接使用此工具类来操作就可以：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.Zone;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.BucketManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.BatchStatus;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QiNiuUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESSKEY = <span class="string">&quot;SFEru-42dYFEvmHot4dz1UhsepDmOPDql0AfFt8p&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRETKEY = <span class="string">&quot;aCzett8JLbldF42PhQGzw6ymQyWreY4Fu8drPKG3&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUCKET = <span class="string">&quot;sz98&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DOMAIN= <span class="string">&quot;http://qfhy5itom.hn-bkt.clouddn.com/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        uploadFile(<span class="string">&quot;C:\\Users\\Eric\\Desktop\\file\\timg.jpg&quot;</span>,<span class="string">&quot;dd2.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">//removeFiles(&quot;20190529083159.jpg&quot;,&quot;20190529083241.jpg&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filenames 需要删除的文件名列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功的文件名列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">removeFiles</span><span class="params">(String... filenames)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 删除成功的文件名列表</span></span><br><span class="line">        List&lt;String&gt; removeSuccessList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">if</span>(filenames.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// 创建仓库管理器</span></span><br><span class="line">            BucketManager bucketManager = getBucketManager();</span><br><span class="line">            <span class="comment">// 创建批处理器</span></span><br><span class="line">            BucketManager.Batch batch = <span class="keyword">new</span> BucketManager.Batch();</span><br><span class="line">            <span class="comment">// 批量删除多个文件</span></span><br><span class="line">            batch.delete(BUCKET,filenames);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 获取服务器的响应</span></span><br><span class="line">                Response res = bucketManager.batch(batch);</span><br><span class="line">                <span class="comment">// 获得批处理的状态</span></span><br><span class="line">                BatchStatus[] batchStatuses = res.jsonToObject(BatchStatus[].class);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; filenames.length; i++) &#123;</span><br><span class="line">                    BatchStatus status = batchStatuses[i];</span><br><span class="line">                    String key = filenames[i];</span><br><span class="line">                    System.out.print(key + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (status.code == <span class="number">200</span>) &#123;</span><br><span class="line">                        removeSuccessList.add(key);</span><br><span class="line">                        System.out.println(<span class="string">&quot;delete success&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;delete failure&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> removeSuccessList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(String localFilePath, String savedFilename)</span></span>&#123;</span><br><span class="line">        UploadManager uploadManager = getUploadManager();</span><br><span class="line">        String upToken = getToken();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Response response = uploadManager.put(localFilePath, savedFilename, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            System.out.println(String.format(<span class="string">&quot;key=%s, hash=%s&quot;</span>,putRet.key, putRet.hash));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            Response r = ex.response;</span><br><span class="line">            System.err.println(r.toString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(r.bodyString());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                <span class="comment">//ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uploadViaByte</span><span class="params">(<span class="keyword">byte</span>[] bytes, String savedFilename)</span></span>&#123;</span><br><span class="line">        UploadManager uploadManager = getUploadManager();</span><br><span class="line">        String upToken = getToken();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Response response = uploadManager.put(bytes, savedFilename, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            System.out.println(putRet.key);</span><br><span class="line">            System.out.println(putRet.hash);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            Response r = ex.response;</span><br><span class="line">            System.err.println(r.toString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(r.bodyString());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                <span class="comment">//ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getToken</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 创建授权</span></span><br><span class="line">        Auth auth = Auth.create(ACCESSKEY, SECRETKEY);</span><br><span class="line">        <span class="comment">// 获得认证后的令牌</span></span><br><span class="line">        String upToken = auth.uploadToken(BUCKET);</span><br><span class="line">        <span class="keyword">return</span> upToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> UploadManager <span class="title">getUploadManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">        Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone2());</span><br><span class="line">        <span class="comment">//构建上传管理器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UploadManager(cfg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BucketManager <span class="title">getBucketManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 创建授权信息</span></span><br><span class="line">        Auth auth = Auth.create(ACCESSKEY, SECRETKEY);</span><br><span class="line">        <span class="comment">// 创建操作某个仓库的管理器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BucketManager(auth, <span class="keyword">new</span> Configuration(Zone.zone2()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将此工具类放在health_common工程中，后续会使用到。</p>
<h3 id="【小结】"><a href="#【小结】" class="headerlink" title="【小结】"></a>【小结】</h3><p>1：介绍</p>
<p>（1） 传统文件存储与云存储方案的区别， 使用云存储</p>
<p>2：七牛云存储</p>
<p>（1）注册</p>
<p>（2）新建存储空间</p>
<p>（3）查看存储空间信息</p>
<p>（4）开发者中心 认证</p>
<p>（5）创建密钥： Access Key, Sercret Key</p>
<p>（6）Java SDK操作七牛云 QiNiuUitls </p>
<p>（7）封装工具类 </p>
<p>QiNiuUitls 存到小抄</p>
<h1 id="2-新增套餐"><a href="#2-新增套餐" class="headerlink" title="2. 新增套餐"></a>2. <strong>新增套餐</strong></h1><h3 id="【目标】-1"><a href="#【目标】-1" class="headerlink" title="【目标】"></a>【目标】</h3><p>新增套餐</p>
<h3 id="【路径】-1"><a href="#【路径】-1" class="headerlink" title="【路径】"></a>【路径】</h3><ol>
<li><p>图片上传</p>
<ul>
<li><p>选中图片后，SetmealController 接收上传的图片</p>
<ul>
<li><p>获取原有图片名称，截取到后缀名</p>
</li>
<li><p>生成唯一文件名，拼接后缀名</p>
</li>
<li><p>调用七牛上传文件</p>
</li>
<li><p>返回数据给页面</p>
<ul>
<li>将来formData提交 要用图片名</li>
<li>页面中图片要回显 完整路径  QiNiuUtils.DOMAIN + 图片名</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    flag:</span><br><span class="line">    message:</span><br><span class="line">    data:&#123;</span><br><span class="line">        imgName: 图片名,</span><br><span class="line">        domain: QiNiuUtils.DOMAIN</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>新建弹出窗口后， 获取所有的检查组绑定tableData供选择与套餐相关的检查组 </p>
<p>CheckGroupController service dao. findAll</p>
</li>
<li><p>提交</p>
<ul>
<li><p>确定事件，提交formData =&gt; Setmeal, checkgroupIds =&gt; Integer[]，提示结果，成功则关闭新增窗口，刷新列表数据</p>
</li>
<li><p>SetmealController 用Setmeal 接收formData,  Integer[]接收checkgroupIds ,调用服务添加，返回结果给页面</p>
</li>
<li><p>SetmealService</p>
<ul>
<li>添加套餐</li>
<li>获取套餐的id</li>
<li>添加套餐与检查组的关系</li>
</ul>
</li>
<li><p>SetmealDao</p>
<ul>
<li>添加套餐 selectKey t_setmeal</li>
<li>添加套餐与检查组的关系 t_setmeal_checkgroup</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="【讲解】-1"><a href="#【讲解】-1" class="headerlink" title="【讲解】"></a>【讲解】</h3><h2 id="2-1-需求分析"><a href="#2-1-需求分析" class="headerlink" title="2.1. 需求分析"></a>2.1. <strong>需求分析</strong></h2><p>套餐其实就是检查组的集合，例如有一个套餐为“入职体检套餐”，这个检查组可以包括多个检查组：一般检查、血常规、尿常规、肝功三项等。</p>
<p>所以在添加套餐时需要选择这个套餐包括的检查组。</p>
<p>套餐对应的实体类为Setmeal，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Setmeal</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String helpCode;</span><br><span class="line">    <span class="keyword">private</span> String sex;<span class="comment">//套餐适用性别：0不限 1男 2女</span></span><br><span class="line">    <span class="keyword">private</span> String age;<span class="comment">//套餐适用年龄</span></span><br><span class="line">    <span class="keyword">private</span> Float price;<span class="comment">//套餐价格</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">    <span class="keyword">private</span> String attention;</span><br><span class="line">    <span class="keyword">private</span> String img;<span class="comment">//套餐对应图片名称（用于存放七牛云上的图片名称-唯一）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CheckGroup&gt; checkGroups;<span class="comment">//体检套餐对应的检查组，多对多关系</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中img字段表示套餐对应图片存储路径（用于存放七牛云上的图片名称）</p>
<p>对应的数据表为t_setmeal。套餐和检查组为多对多关系，所以需要中间表t_setmeal_checkgroup进行关联。</p>
<p>t_setmeal表</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162749.png" alt="img"> </p>
<p>t_setmeal_checkgroup表</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162750.png" alt="img"> </p>
<h2 id="2-2-前台代码"><a href="#2-2-前台代码" class="headerlink" title="2.2. 前台代码"></a>2.2. 前台代码</h2><p>套餐管理页面对应的是setmeal.html页面，根据产品设计的原型已经完成了页面基本结构的编写，现在需要完善页面动态效果。</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162751.png" alt="img"> </p>
<h3 id="2-2-1-弹出新增窗口"><a href="#2-2-1-弹出新增窗口" class="headerlink" title="2.2.1. 弹出新增窗口"></a>2.2.1. <strong>弹出新增窗口</strong></h3><p>页面中已经提供了新增窗口，只是出于隐藏状态。只需要将控制展示状态的属性dialogFormVisible改为true接口显示出新增窗口。点击新建按钮时绑定的方法为handleCreate，所以在handleCreate方法中修改dialogFormVisible属性的值为true即可。同时为了增加用户体验度，需要每次点击新建按钮时清空表单输入项。</p>
<p>由于新增套餐时还需要选择此套餐包含的检查组，所以新增套餐窗口分为两部分信息：基本信息和检查组信息，如下图：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162752.png" alt="img"> </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162753.png" alt="img"> </p>
<p>（1）：新建按钮绑定单击事件，对应的处理函数为handleCreate</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;butT&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate()&quot;</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）：handleCreate()方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重置表单</span></span><br><span class="line"><span class="function"><span class="title">resetForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 清空表单内容</span></span><br><span class="line">    <span class="built_in">this</span>.formData = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 清空选中的检查组</span></span><br><span class="line">    <span class="built_in">this</span>.checkgroupIds = [];</span><br><span class="line">    <span class="comment">// 默认展示套餐基本信息标签页</span></span><br><span class="line">    <span class="built_in">this</span>.activeName = <span class="string">&#x27;first&#x27;</span>;</span><br><span class="line">    <span class="comment">// 清除选中的图片</span></span><br><span class="line">    <span class="built_in">this</span>.imageUrl = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.formData.img = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="function"><span class="title">handleCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.resetForm();</span><br><span class="line">    <span class="comment">//弹出添加窗口</span></span><br><span class="line">    <span class="built_in">this</span>.dialogFormVisible = <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-动态展示检查组列表"><a href="#2-2-2-动态展示检查组列表" class="headerlink" title="2.2.2. 动态展示检查组列表"></a>2.2.2. <strong>动态展示检查组列表</strong></h3><p>现在虽然已经完成了新增窗口的弹出，但是在检查组信息标签页中需要动态展示所有的检查组信息列表数据，并且可以进行勾选。具体操作步骤如下：</p>
<p>（1）定义模型数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">tableData:[],<span class="comment">//添加表单窗口中检查组列表数据</span></span><br><span class="line"><span class="attr">checkgroupIds</span>:[],<span class="comment">//添加表单窗口中检查组复选框对应id</span></span><br></pre></td></tr></table></figure>

<p>（2）动态展示检查组列表数据，数据来源于上面定义的tableData模型数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;检查组信息&quot;</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkScrol&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;datatable&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">th</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目编码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目说明<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--循环遍历tableData--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;c in tableData&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--复选框绑定checkgroupIds，存放到值是id--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;c.id&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checkgroupIds&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.code&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.name&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.remark&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 其中：v-model=”checkgroupIds”，用于回显复选框。</p>
<p>（3）完善handleCreate方法，发送ajax请求查询所有检查组数据并将结果赋值给tableData模型数据用于页面表格展示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="function"><span class="title">handleCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.resetForm();</span><br><span class="line">    <span class="comment">//弹出添加窗口</span></span><br><span class="line">    <span class="built_in">this</span>.dialogFormVisible = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 加载检查组列表数据</span></span><br><span class="line">    axios.get(<span class="string">&#x27;/checkgroup/findAll.do&#x27;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.data.flag)&#123;</span><br><span class="line">            <span class="built_in">this</span>.tableData = res.data.data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.error(res.data.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>（4）分别在CheckGroupController、CheckGroupService、CheckGroupServiceImpl、CheckGroupDao、CheckGroupDao.xml中扩展方法查询所有检查组数据</p>
<p>1：CheckGroupController：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/findAll&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;CheckGroup&gt; all = checkGroupService.findAll();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.QUERY_CHECKGROUP_SUCCESS,all);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2：CheckGroupService：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有检查组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;CheckGroup&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>3：CheckGroupServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有检查组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CheckGroup&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> checkGroupDao.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4：CheckGroupDao：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有检查组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;CheckGroup&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>5：CheckGroupDao.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;checkgroup&quot;</span>&gt;</span></span><br><span class="line">    select * From t_checkgroup</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-3-图片上传并预览"><a href="#2-2-3-图片上传并预览" class="headerlink" title="2.2.3. 图片上传并预览"></a>2.2.3. <strong>图片上传并预览</strong></h3><p>此处使用的是ElementUI提供的上传组件el-upload，提供了多种不同的上传效果，上传成功后可以进行预览。</p>
<p>实现步骤：</p>
<p>（1）定义模型数据，用于后面上传文件的图片预览：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">imageUrl:<span class="literal">null</span>,<span class="comment">//模型数据，用于上传图片完成后图片预览</span></span><br></pre></td></tr></table></figure>

<p>（2）定义ElementUI上传组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;上传图片&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- action: 提交图片的url, 接收图片的止传</span></span><br><span class="line"><span class="comment">        auto-upload: 是否自动上传文件，选择完文件后就马上上传到action的url里</span></span><br><span class="line"><span class="comment">        name: 上传文件的参数名, MultipartFile imgFile</span></span><br><span class="line"><span class="comment">        show-file-list: 显示上传的文件列表，这里只需要一张图片，不要显示</span></span><br><span class="line"><span class="comment">        on-success: 上传成功后回调的方法</span></span><br><span class="line"><span class="comment">        before-upload: 上传前调用的方法</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">action</span>=<span class="string">&quot;/setmeal/upload.do&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:auto-upload</span>=<span class="string">&quot;autoUpload&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;imgFile&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:show-file-list</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:on-success</span>=<span class="string">&quot;handleAvatarSuccess&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:before-upload</span>=<span class="string">&quot;beforeAvatarUpload&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  图片回显，如果imageUrl有值，则输出img标签</span></span><br><span class="line"><span class="comment">        上传图片成功后要用imageUrl赋值 完整的路径</span></span><br><span class="line"><span class="comment">        后台响应回来的数据格式  imageUrl=domain+imgName</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">           flag:</span></span><br><span class="line"><span class="comment">           message:</span></span><br><span class="line"><span class="comment">           data: &#123;</span></span><br><span class="line"><span class="comment">              imgName: 图片名称  保存到数据库</span></span><br><span class="line"><span class="comment">              domain: 七牛的域名</span></span><br><span class="line"><span class="comment">           &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus avatar-uploader-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）定义对应的钩子函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleAvatarSuccess</span>(<span class="params">response, file</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 提示成功或失败，要回显图片</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">message</span>: response.message,</span><br><span class="line">        <span class="attr">type</span>: response.flag?<span class="string">&quot;success&quot;</span>:<span class="string">&quot;error&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(response.flag)&#123;</span><br><span class="line">        <span class="comment">// 回显图片</span></span><br><span class="line">        <span class="built_in">this</span>.imageUrl = response.data.domain + response.data.imgName;</span><br><span class="line">        <span class="comment">// 表单中没有img参数，后台数据库用的就是img字段，补上它的值</span></span><br><span class="line">        <span class="comment">// 前端中的json数据 &#123;key,value&#125;=&gt; map,</span></span><br><span class="line">        <span class="comment">// 对象.属性名(不存在) =&gt; map.put(不存在的key,value)</span></span><br><span class="line">        <span class="built_in">this</span>.formData.img = response.data.imgName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">//上传图片之前执行</span></span><br><span class="line"><span class="function"><span class="title">beforeAvatarUpload</span>(<span class="params">file</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isJPG = file.type === <span class="string">&#x27;image/jpeg&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> isLt2M = file.size / <span class="number">1024</span> / <span class="number">1024</span> &lt; <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (!isJPG) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$message.error(<span class="string">&#x27;上传套餐图片只能是 JPG 格式!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isLt2M) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$message.error(<span class="string">&#x27;上传套餐图片大小不能超过 2MB!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isJPG &amp;&amp; isLt2M;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>（4）创建SetmealController，接收上传的文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.utils.QiNiuUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: No Description</span></span><br><span class="line"><span class="comment"> * User: Eric</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetmealController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 套餐上传图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">upload</span><span class="params">(MultipartFile imgFile)</span></span>&#123;</span><br><span class="line">        <span class="comment">//- 获取原有图片名称，截取到后缀名</span></span><br><span class="line">        String originalFilename = imgFile.getOriginalFilename();</span><br><span class="line">        String extension = originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//- 生成唯一文件名，拼接后缀名</span></span><br><span class="line">        String filename = UUID.randomUUID() + extension;</span><br><span class="line">        <span class="comment">//- 调用七牛上传文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            QiNiuUtils.uploadViaByte(imgFile.getBytes(), filename);</span><br><span class="line">            <span class="comment">//- 返回数据给页面</span></span><br><span class="line">            <span class="comment">//&#123;</span></span><br><span class="line">            <span class="comment">//    flag:</span></span><br><span class="line">            <span class="comment">//    message:</span></span><br><span class="line">            <span class="comment">//    data:&#123;</span></span><br><span class="line">            <span class="comment">//        imgName: 图片名,</span></span><br><span class="line">            <span class="comment">//        domain: QiNiuUtils.DOMAIN</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;imgName&quot;</span>,filename);</span><br><span class="line">            map.put(<span class="string">&quot;domain&quot;</span>, QiNiuUtils.DOMAIN);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.PIC_UPLOAD_SUCCESS,map);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：别忘了在spring配置文件中配置文件上传组件</p>
<p>已在springmvc.xml中配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;104857600&quot;</span> /&gt;</span><span class="comment">&lt;!--最大上传文件大小--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4096&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-提交请求"><a href="#2-2-4-提交请求" class="headerlink" title="2.2.4. 提交请求"></a>2.2.4. <strong>提交请求</strong></h3><p>当用户点击新增窗口中的确定按钮时发送ajax请求将数据提交到后台进行数据库操作。提交到后台的数据分为两部分：套餐基本信息（对应的模型数据为formData）和检查组id数组（对应的模型数据为checkgroupIds）。</p>
<p>（1）为确定按钮绑定单击事件，对应的处理函数为handleAdd</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;dialogFormVisible = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）完善handleAdd方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//添加提交</span></span><br><span class="line">handleAdd () &#123;</span><br><span class="line">    axios.post(<span class="string">&#x27;/setmeal/add.do?checkgroupIds=&#x27;</span> + <span class="built_in">this</span>.checkgroupIds, <span class="built_in">this</span>.formData).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">message</span>: res.data.message,</span><br><span class="line">            <span class="attr">type</span>: res.data.flag?<span class="string">&quot;success&quot;</span>:<span class="string">&quot;error&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span>(res.data.flag)&#123;</span><br><span class="line">            <span class="comment">// 关闭添加窗口</span></span><br><span class="line">            <span class="built_in">this</span>.dialogFormVisible = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 刷新列表数据</span></span><br><span class="line">            <span class="built_in">this</span>.findPage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="2-3-后台代码"><a href="#2-3-后台代码" class="headerlink" title="2.3. 后台代码"></a>2.3. <strong>后台代码</strong></h2><h3 id="2-3-1-Controller"><a href="#2-3-1-Controller" class="headerlink" title="2.3.1. Controller"></a>2.3.1. <strong>Controller</strong></h3><p>在SetmealController中增加方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> Setmeal setmeal, Integer[] checkgroupIds)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 调用业务服务添加</span></span><br><span class="line">    setmealService.add(setmeal, checkgroupIds);</span><br><span class="line">    <span class="comment">// 响应结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.ADD_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-2-服务接口"><a href="#2-3-2-服务接口" class="headerlink" title="2.3.2. 服务接口"></a>2.3.2. <strong>服务接口</strong></h3><p>创建SetmealService接口并提供新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.health.pojo.Setmeal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: No Description</span></span><br><span class="line"><span class="comment"> * User: Eric</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SetmealService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkgroupIds</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-服务实现类"><a href="#2-3-3-服务实现类" class="headerlink" title="2.3.3. 服务实现类"></a>2.3.3. <strong>服务实现类</strong></h3><p>创建SetmealServiceImpl服务实现类并实现新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.dao.SetmealDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.health.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: No Description</span></span><br><span class="line"><span class="comment"> * User: Eric</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = SetmealService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title">SetmealService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDao setmealDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkgroupIds</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 添加套餐信息</span></span><br><span class="line">        setmealDao.add(setmeal);</span><br><span class="line">        <span class="comment">// 获取套餐的id</span></span><br><span class="line">        Integer setmealId = setmeal.getId();</span><br><span class="line">        <span class="comment">// 添加套餐与检查组的关系</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != checkgroupIds)&#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer checkgroupId : checkgroupIds) &#123;</span><br><span class="line">                setmealDao.addSetmealCheckGroup(setmealId, checkgroupId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-Dao接口"><a href="#2-3-4-Dao接口" class="headerlink" title="2.3.4. Dao接口"></a>2.3.4. <strong>Dao接口</strong></h3><p>创建SetmealDao接口并提供相关方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.health.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: No Description</span></span><br><span class="line"><span class="comment"> * User: Eric</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SetmealDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Setmeal setmeal)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加套餐与检查组的关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkgroupId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addSetmealCheckGroup</span><span class="params">(<span class="meta">@Param(&quot;setmealId&quot;)</span> Integer setmealId, <span class="meta">@Param(&quot;checkgroupId&quot;)</span> Integer checkgroupId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-5-Mapper映射文件"><a href="#2-3-5-Mapper映射文件" class="headerlink" title="2.3.5. Mapper映射文件"></a>2.3.5. <strong>Mapper映射文件</strong></h3><p>创建SetmealDao.xml文件并定义相关SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.health.dao.SetmealDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;setmeal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span>&gt;</span></span><br><span class="line">            select last_insert_id()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into t_setmeal (name,code,helpCode,sex,age,price,remark,attention,img)</span><br><span class="line">        values(#&#123;name&#125;,#&#123;code&#125;,#&#123;helpCode&#125;,#&#123;sex&#125;,#&#123;age&#125;,#&#123;price&#125;,#&#123;remark&#125;,#&#123;attention&#125;,#&#123;img&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addSetmealCheckGroup&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        insert into t_setmeal_checkgroup (setmeal_id, checkgroup_id)</span><br><span class="line">        values (#&#123;setmealId&#125;,#&#123;checkgroupId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-完善文件上传，Redis存储图片名称（忽略，后续实现）"><a href="#2-4-完善文件上传，Redis存储图片名称（忽略，后续实现）" class="headerlink" title="2.4.  完善文件上传，Redis存储图片名称（忽略，后续实现）"></a>2.4.  完善文件上传，Redis存储图片名称（忽略，后续实现）</h2><p>前面我们已经完成了文件上传，将图片存储在了七牛云服务器中。但是这个过程存在一个问题，就是如果用户只上传了图片而没有最终保存套餐信息到我们的数据库，这时我们上传的图片就变为了垃圾图片。对于这些垃圾图片我们需要定时清理来释放磁盘空间。这就需要我们能够区分出来哪些是垃圾图片，哪些不是垃圾图片。如何实现呢？</p>
<p>方案就是利用redis来保存图片名称，具体做法为：</p>
<p>1、当用户上传图片后，将图片名称保存到redis的一个Set集合中，例如集合名称为setmealPicResources</p>
<p>2、当用户添加套餐后，将图片名称保存到redis的另一个Set集合中，例如集合名称为setmealPicDbResources</p>
<p>3、计算setmealPicResources集合与setmealPicDbResources集合的差值，结果就是垃圾图片的名称集合，清理这些图片即可</p>
<p>本小节我们先来完成前面2个环节，第3个环节（清理图片环节）在后面会通过定时任务再实现。</p>
<p>实现步骤：</p>
<p>（1）在health_web项目中提供Spring配置文件spring-redis.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Jedis连接池的相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时在springmvc.xml中使用<import>标签引入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-redis.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）在health_common工程中提供Redis常量类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.health.constant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConstant</span> </span>&#123;</span><br><span class="line">    <span class="comment">//套餐图片所有图片名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SETMEAL_PIC_RESOURCES = <span class="string">&quot;setmealPicResources&quot;</span>;</span><br><span class="line">    <span class="comment">//套餐图片保存在数据库中的图片名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SETMEAL_PIC_DB_RESOURCES = <span class="string">&quot;setmealPicDbResources&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）完善SetmealController，在文件上传成功后将图片名称保存到redis集合中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line"><span class="comment">//图片上传</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;imgFile&quot;)</span>MultipartFile imgFile)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//获取原始文件名</span></span><br><span class="line">        String originalFilename = imgFile.getOriginalFilename();</span><br><span class="line">        <span class="keyword">int</span> lastIndexOf = originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="comment">//获取文件后缀</span></span><br><span class="line">        String suffix = originalFilename.substring(lastIndexOf);</span><br><span class="line">        <span class="comment">//使用UUID随机产生文件名称，防止同名文件覆盖</span></span><br><span class="line">        String fileName = UUID.randomUUID().toString() + suffix;</span><br><span class="line">        QiniuUtils.upload2Qiniu(imgFile.getBytes(),fileName);</span><br><span class="line">        <span class="comment">//图片上传成功</span></span><br><span class="line">        Result result = <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.PIC_UPLOAD_SUCCESS,fileName);</span><br><span class="line">        <span class="comment">//将上传图片名称存入Redis，基于Redis的Set集合存储</span></span><br><span class="line">        jedisPool.getResource().sadd(RedisConstant.SETMEAL_PIC_RESOURCES,fileName);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="comment">//图片上传失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>,MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将上传图片名称存入Redis，基于Redis的Set集合存储    </span></span><br><span class="line">jedisPool.getResource().sadd(RedisConstant.SETMEAL_PIC_RESOURCES,fileName);</span><br></pre></td></tr></table></figure>



<p>（4）完善SetmealController服务类，在保存完成套餐信息后将图片名称存储到redis集合中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> Setmeal setmeal, Integer[] checkgroupIds)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 调用服务更新</span></span><br><span class="line">    setmealService.add(setmeal, checkgroupIds);</span><br><span class="line">    <span class="comment">// 添加成功，要记录有用的图片到redis集合中</span></span><br><span class="line">    Jedis jedis = jedisPool.getResource();</span><br><span class="line">    jedis.sadd(RedisConstant.SETMEAL_PIC_DB_RESOURCES, setmeal.getImg());</span><br><span class="line">    jedis.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.ADD_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> Setmeal setmeal, Integer[] checkgroupIds)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取原有图片的名称，判断图片是否更改了，如果更改了，那么旧的图片应该从有用的集合中移除</span></span><br><span class="line">    Setmeal setmealInDb = setmealService.findById(setmeal.getId());</span><br><span class="line">    <span class="comment">// 调用服务更新</span></span><br><span class="line">    setmealService.update(setmeal, checkgroupIds);</span><br><span class="line">    Jedis jedis = jedisPool.getResource();</span><br><span class="line">    <span class="comment">// 判断是否是需要从有用的集合中删除</span></span><br><span class="line">    <span class="keyword">if</span>(!setmealInDb.getImg().equals(setmeal.getImg()))&#123;</span><br><span class="line">        <span class="comment">//图片修改了，旧的就没用，就要删除</span></span><br><span class="line">        jedis.srem(RedisConstant.SETMEAL_PIC_DB_RESOURCES, setmealInDb.getImg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改成功，要记录有用的图片到redis集合中</span></span><br><span class="line"></span><br><span class="line">    jedis.sadd(RedisConstant.SETMEAL_PIC_DB_RESOURCES, setmeal.getImg());</span><br><span class="line">    jedis.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.EDIT_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除套餐</span></span><br><span class="line"> * 删除</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 查一下图片名称</span></span><br><span class="line">    Setmeal setmeal = setmealService.findById(id);</span><br><span class="line">    <span class="comment">// 调用业务服务删除</span></span><br><span class="line">    setmealService.deleteById(id);</span><br><span class="line">    <span class="comment">// 从redis，保存了数据库存放的图片集合中移除这个被删除的图片</span></span><br><span class="line">    Jedis jedis = jedisPool.getResource();</span><br><span class="line">    jedis.srem(RedisConstant.SETMEAL_PIC_DB_RESOURCES, setmeal.getImg());</span><br><span class="line">    jedis.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.DELETE_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162754.png" alt="img"> </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162755.png" alt="img"> </p>
<p>删除垃圾图片，根据以下代码完成，在health_web工程下，创建测试类，进行删除</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring-redis.xml&quot;)</span></span><br><span class="line"><span class="meta">@RunWith(value = SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDeletePic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除Redis中2个不同key值存储的不同图片</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; set = jedisPool.getResource().sdiff(RedisConstant.SETMEAL_PIC_RESOURCE, RedisConstant.SETMEAL_PIC_DB_RESOURCE);</span><br><span class="line">        Iterator&lt;String&gt; iterator = set.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            String pic = iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;删除的图片：&quot;</span>+pic);</span><br><span class="line">            <span class="comment">// 删除七牛云上的图片</span></span><br><span class="line">            QiniuUtils.deleteFileFromQiniu(pic);</span><br><span class="line">            <span class="comment">// 删除Redis中key值为SETMEAL_PIC_RESOURCE的数据</span></span><br><span class="line">            jedisPool.getResource().srem(RedisConstant.SETMEAL_PIC_RESOURCE,pic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目经理说，代码已经完成，让你在凌晨的时候去执行以上代码。我们不会真正的待到凌晨去执行，那怎么办呢？</p>
<p>跳转到“第四章”，学习任务调度Quartz</p>
<h3 id="【小结】-1"><a href="#【小结】-1" class="headerlink" title="【小结】"></a>【小结】</h3><ol>
<li>上传到七牛上的图片名称要唯一</li>
<li>elementUI的upload组件成功时会回调handleAvatarSuccess(response) 经过elementUI处理过的，response=&gt;Result.</li>
<li>套餐中的图片：页面中要显示（全路径），数据库只存储它的名称，form表单对<img>不会提交，没有img, 补全formData补全img。</li>
</ol>
<p>==4：完善文件上传，Redis存储图片名称（一会说）==</p>
<h1 id="3-体检套餐分页"><a href="#3-体检套餐分页" class="headerlink" title="3. 体检套餐分页"></a>3. 体检套餐分页</h1><h3 id="【目标】-2"><a href="#【目标】-2" class="headerlink" title="【目标】"></a>【目标】</h3><p>体检套餐列表分页</p>
<h3 id="【路径】-2"><a href="#【路径】-2" class="headerlink" title="【路径】"></a>【路径】</h3><p>1：前台代码</p>
<p>（1）定义分页相关模型数据  pagination, QueryPageBean</p>
<p>（2）定义分页方法  findPage</p>
<p>（3）完善分页方法执行时机 加载，查询(1), 页码变更，添加成功后，修改成功，删除后</p>
<p>2：后台代码</p>
<p>业务：</p>
<ul>
<li>体检套餐分页列表展示</li>
</ul>
<p>findPage方法：</p>
<ol>
<li>提交查询条件分页信息 pagination, 提示结果，且把返回的结果集res.data.data.rows绑定dataList, 总计录数绑定pagination.total</li>
<li>SetmealController接收 QueryPageBean, 调用业务服务查询 pageResult, 包装到Result返回给前端</li>
<li>SetmealServiceImp 使用PageHelper分页，有查询条件实现模糊查询 拼接%，调用dao查询，返回PageResult对象</li>
<li>SetmealDao findByCondition</li>
</ol>
<h3 id="【讲解】-2"><a href="#【讲解】-2" class="headerlink" title="【讲解】"></a>【讲解】</h3><h2 id="3-1-前台代码"><a href="#3-1-前台代码" class="headerlink" title="3.1. 前台代码"></a>3.1. 前台代码</h2><h3 id="3-1-1-定义分页相关模型数据"><a href="#3-1-1-定义分页相关模型数据" class="headerlink" title="3.1.1. 定义分页相关模型数据"></a>3.1.1. <strong>定义分页相关模型数据</strong></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pagination: &#123;<span class="comment">//分页相关模型数据</span></span><br><span class="line">    <span class="attr">currentPage</span>: <span class="number">1</span>,<span class="comment">//当前页码</span></span><br><span class="line">    <span class="attr">pageSize</span>:<span class="number">10</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">    <span class="attr">total</span>:<span class="number">0</span>,<span class="comment">//总记录数</span></span><br><span class="line">    <span class="attr">queryString</span>:<span class="literal">null</span><span class="comment">//查询条件</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">dataList</span>: [],<span class="comment">//当前页要展示的分页列表数据</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-定义分页方法"><a href="#3-1-2-定义分页方法" class="headerlink" title="3.1.2. 定义分页方法"></a>3.1.2. <strong>定义分页方法</strong></h3><p>（1）在页面中提供了findPage方法用于分页查询，为了能够在setmeal.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//钩子函数，VUE对象初始化完成后自动执行</span></span><br><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.findPage();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>（2）findPage()方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="function"><span class="title">findPage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    axios.post(<span class="string">&#x27;/setmeal/findPage.do&#x27;</span>, <span class="built_in">this</span>.pagination).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.data.flag)&#123;</span><br><span class="line">            <span class="comment">// 绑定分页的结果集</span></span><br><span class="line">            <span class="built_in">this</span>.dataList = res.data.data.rows;</span><br><span class="line">            <span class="comment">// 总计录数</span></span><br><span class="line">            <span class="built_in">this</span>.pagination.total = res.data.data.total;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.error(res.data.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h3 id="3-1-3-完善分页方法执行时机"><a href="#3-1-3-完善分页方法执行时机" class="headerlink" title="3.1.3. 完善分页方法执行时机"></a>3.1.3. <strong>完善分页方法执行时机</strong></h3><p>除了在created钩子函数中调用findPage方法查询分页数据之外，当用户点击查询按钮或者点击分页条中的页码时也需要调用findPage方法重新发起查询请求。</p>
<p>（1）为查询按钮绑定单击事件，调用findPage方法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleCurrentChange(1)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dalfBut&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）为分页条组件绑定current-change事件，此事件是分页条组件自己定义的事件，当页码改变时触发，对应的处理函数为handleCurrentChange</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pagination-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;pagiantion&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:current-page</span>=<span class="string">&quot;pagination.currentPage&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:page-size</span>=<span class="string">&quot;pagination.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">layout</span>=<span class="string">&quot;total, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:total</span>=<span class="string">&quot;pagination.total&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义handleCurrentChange方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//切换页码</span></span><br><span class="line"><span class="function"><span class="title">handleCurrentChange</span>(<span class="params">currentPage</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//currentPage为切换后的页码</span></span><br><span class="line">    <span class="built_in">this</span>.pagination.currentPage = currentPage;</span><br><span class="line">    <span class="built_in">this</span>.findPage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-后台代码"><a href="#3-2-后台代码" class="headerlink" title="3.2. 后台代码"></a>3.2. <strong>后台代码</strong></h2><h3 id="3-2-1-Controller"><a href="#3-2-1-Controller" class="headerlink" title="3.2.1. Controller"></a>3.2.1. <strong>Controller</strong></h3><p>在SetmealController中增加分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/findPage&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findPage</span><span class="params">(<span class="meta">@RequestBody</span> QueryPageBean queryPageBean)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 调用服务分页查询</span></span><br><span class="line">    PageResult&lt;Setmeal&gt; pageResult = setmealService.findPage(queryPageBean);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.QUERY_SETMEAL_SUCCESS,pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-服务接口"><a href="#3-2-2-服务接口" class="headerlink" title="3.2.2. 服务接口"></a>3.2.2. <strong>服务接口</strong></h3><p>在SetmealService服务接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryPageBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">PageResult&lt;Setmeal&gt; <span class="title">findPage</span><span class="params">(QueryPageBean queryPageBean)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-服务实现类"><a href="#3-2-3-服务实现类" class="headerlink" title="3.2.3. 服务实现类"></a>3.2.3. <strong>服务实现类</strong></h3><p>在SetmealServiceImpl服务实现类中实现分页查询方法，基于Mybatis分页助手插件实现分页</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryPageBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageResult&lt;Setmeal&gt; <span class="title">findPage</span><span class="params">(QueryPageBean queryPageBean)</span> </span>&#123;</span><br><span class="line">    PageHelper.startPage(queryPageBean.getCurrentPage(), queryPageBean.getPageSize());</span><br><span class="line">    <span class="comment">// 查询条件</span></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(queryPageBean.getQueryString()))&#123;</span><br><span class="line">        <span class="comment">// 模糊查询 %</span></span><br><span class="line">        queryPageBean.setQueryString(<span class="string">&quot;%&quot;</span> + queryPageBean.getQueryString() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 条件查询，这个查询语句会被分页</span></span><br><span class="line">    Page&lt;Setmeal&gt; page = setmealDao.findByCondition(queryPageBean.getQueryString());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageResult&lt;Setmeal&gt;(page.getTotal(), page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-Dao接口"><a href="#3-2-4-Dao接口" class="headerlink" title="3.2.4. Dao接口"></a>3.2.4. <strong>Dao接口</strong></h3><p>在SetmealDao接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryString</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Page&lt;Setmeal&gt; <span class="title">findByCondition</span><span class="params">(String queryString)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-5-Mapper映射文件"><a href="#3-2-5-Mapper映射文件" class="headerlink" title="3.2.5. Mapper映射文件"></a>3.2.5. <strong>Mapper映射文件</strong></h3><p>在SetmealDao.xml文件中增加SQL定义</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;setmeal&quot;</span>&gt;</span></span><br><span class="line">    select * From t_setmeal</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;value != null and value.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">        where code like #&#123;queryString&#125; or name like #&#123;queryString&#125; or helpCode like #&#123;queryString&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="【小结】-2"><a href="#【小结】-2" class="headerlink" title="【小结】"></a>【小结】</h3><p>1：前台代码</p>
<p>（1）定义分页相关模型数据</p>
<p>（2）定义分页方法</p>
<p>（3）完善分页方法执行时机</p>
<h1 id="4-编辑套餐"><a href="#4-编辑套餐" class="headerlink" title="4. 编辑套餐"></a>4. 编辑套餐</h1><h3 id="【目标】-3"><a href="#【目标】-3" class="headerlink" title="【目标】"></a>【目标】</h3><p>编辑套餐</p>
<h3 id="【路径】-3"><a href="#【路径】-3" class="headerlink" title="【路径】"></a>【路径】</h3><p>（1）绑定“编辑”单击事件</p>
<p>（2）弹出编辑窗口回显数据, 表单初始化</p>
<ul>
<li><p>回显套餐数据, 图片预览(setmeal.img=图片名称) 设置图片的完整路径 {setmeal: setmeal, imageUrl: domain+setmeal.getImg()}</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    flag:</span><br><span class="line">    message:</span><br><span class="line">    data:&#123;</span><br><span class="line">         setmeal: setmeal,</span><br><span class="line">         domain: QiNiuUtils.DOMAIN</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">this.formData = res.data.data.setmeal</span><br><span class="line">this.imageUrl =  res.data.data.domain +  this.formData.img</span><br></pre></td></tr></table></figure></li>
<li><p>查询检查组列表</p>
</li>
<li><p>当前套餐具有的检查组的ID, 供复选框需要选中</p>
</li>
</ul>
<p>（3）发送请求，编辑保存套餐</p>
<ul>
<li>编辑保存套餐</li>
<li>删除套餐检查组中间表数据，重新添加套餐检查组中间表数据</li>
</ul>
<h3 id="【讲解】-3"><a href="#【讲解】-3" class="headerlink" title="【讲解】"></a>【讲解】</h3><h2 id="4-1-前台页面"><a href="#4-1-前台页面" class="headerlink" title="4.1. 前台页面"></a>4.1. 前台页面</h2><p>用户点击编辑按钮时，需要弹出编辑窗口并且将当前记录的数据进行回显，用户修改完成后点击确定按钮将修改后的数据提交到后台进行数据库操作。此处进行数据回显的时候，除了需要将套餐基本信息的回显之外，还需要回显当前套餐包含的检查组（以复选框勾选的形式回显）。</p>
<h3 id="4-1-1-绑定单击事件"><a href="#4-1-1-绑定单击事件" class="headerlink" title="4.1.1. 绑定单击事件"></a>4.1.1. <strong>绑定单击事件</strong></h3><p>（1）需要为编辑按钮绑定单击事件，并且将当前行数据作为参数传递给处理函数</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpdate(scope.row)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）在methods中添加handleUpdate方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出编辑窗口</span></span><br><span class="line"><span class="function"><span class="title">handleUpdate</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">    alert(row.id);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h3 id="4-1-2-弹出编辑窗口回显数据"><a href="#4-1-2-弹出编辑窗口回显数据" class="headerlink" title="4.1.2. 弹出编辑窗口回显数据"></a>4.1.2. <strong>弹出编辑窗口回显数据</strong></h3><p>编写当前页面的编辑窗口，可以复制新增套餐窗口进行修改，默认需要处于隐藏状态。</p>
<p>（1）在vue的data中定义模型</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">dialogFormVisible4Edit:<span class="literal">false</span><span class="comment">//控制编辑窗口显示/隐藏</span></span><br></pre></td></tr></table></figure>

<p>（2）定义编辑窗口页面</p>
<p>在新增窗口的下方 添加编辑弹出窗口</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;edit-form&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;编辑套餐&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogFormVisible4Edit&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;activeName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;基本信息&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-position</span>=<span class="string">&quot;right&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;编码&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.code&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;名称&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.name&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;适用性别&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.sex&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;不限&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;男&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;女&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;助记码&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.helpCode&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;套餐价格&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.price&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;适用年龄&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.age&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;上传图片&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">class</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">action</span>=<span class="string">&quot;/setmeal/upload.do&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:auto-upload</span>=<span class="string">&quot;autoUpload&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">name</span>=<span class="string">&quot;imgFile&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:show-file-list</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:on-success</span>=<span class="string">&quot;handleAvatarSuccess&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:before-upload</span>=<span class="string">&quot;beforeAvatarUpload&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus avatar-uploader-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;说明&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.remark&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;注意事项&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.attention&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;检查组信息&quot;</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkScrol&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;datatable&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目编码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目说明<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;c in tableData&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;c.id&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checkgroupIds&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.code&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.name&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.remark&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;dialogFormVisible4Edit = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加确定事件的方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 编辑提交</span></span><br><span class="line"><span class="function"><span class="title">handleEdit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在handleUpdate方法中需要将编辑窗口展示出来，并且需要发送多个ajax请求分别查询当前套餐数据、所有检查组列表数据、当前套餐包含的检查组id用于基本数据回显</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出编辑窗口</span></span><br><span class="line"><span class="function"><span class="title">handleUpdate</span>(<span class="params">row</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.resetForm();</span><br><span class="line">    <span class="built_in">this</span>.dialogFormVisible4Edit = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 套餐的id</span></span><br><span class="line">    <span class="keyword">var</span> id = row.id;</span><br><span class="line">    axios.get(<span class="string">&quot;/setmeal/findById.do?id=&quot;</span> + id).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.data.flag)&#123;</span><br><span class="line">            <span class="comment">// 回显套餐信息</span></span><br><span class="line">            <span class="comment">// res.data.data =&gt; resultMap &#123;setmeal, domain&#125;</span></span><br><span class="line">            <span class="built_in">this</span>.formData = res.data.data.setmeal;</span><br><span class="line">            <span class="comment">// 回显图片</span></span><br><span class="line">            <span class="built_in">this</span>.imageUrl = res.data.data.domain+<span class="built_in">this</span>.formData.img;</span><br><span class="line">            axios.get(<span class="string">&#x27;/checkgroup/findAll.do&#x27;</span>).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(resp.data.flag)&#123;</span><br><span class="line">                    <span class="built_in">this</span>.tableData = resp.data.data;</span><br><span class="line">                    <span class="comment">// 获取选中的检查组id</span></span><br><span class="line">                    axios.get(<span class="string">&#x27;/setmeal/findCheckgroupIdsBySetmealId.do?id=&#x27;</span> + id).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(response.data.flag)&#123;</span><br><span class="line">                            <span class="built_in">this</span>.checkgroupIds = response.data.data;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="built_in">this</span>.$message.error(response.data.message);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">this</span>.$message.error(resp.data.message);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.error(res.data.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="4-1-3-发送请求，编辑保存套餐"><a href="#4-1-3-发送请求，编辑保存套餐" class="headerlink" title="4.1.3. 发送请求，编辑保存套餐"></a>4.1.3. 发送请求，编辑保存套餐</h3><p>（1）在编辑窗口中修改完成后，点击确定按钮需要提交请求，所以需要为确定按钮绑定事件并提供处理函数handleEdit</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）handleEdit()方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 编辑提交</span></span><br><span class="line"><span class="function"><span class="title">handleEdit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//提交检查组信息this.formData, 选中的检查项id this.checkgroupIds</span></span><br><span class="line">    axios.post(<span class="string">&#x27;/setmeal/update.do?checkgroupIds=&#x27;</span> + <span class="built_in">this</span>.checkgroupIds, <span class="built_in">this</span>.formData).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">message</span>: res.data.message,</span><br><span class="line">            <span class="attr">type</span>: res.data.flag?<span class="string">&quot;success&quot;</span>:<span class="string">&quot;error&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span>(res.data.flag)&#123;</span><br><span class="line">            <span class="comment">// 关闭编辑窗口</span></span><br><span class="line">            <span class="built_in">this</span>.dialogFormVisible4Edit = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 刷新列表数据</span></span><br><span class="line">            <span class="built_in">this</span>.findPage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-2-后台代码"><a href="#4-2-后台代码" class="headerlink" title="4.2. 后台代码"></a>4.2. <strong>后台代码</strong></h2><h3 id="4-2-1-Controller"><a href="#4-2-1-Controller" class="headerlink" title="4.2.1. Controller"></a>4.2.1. <strong>Controller</strong></h3><p>在SetmealController中增加方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询套餐信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findById&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 调用服务查询</span></span><br><span class="line">    Setmeal setmeal = setmealService.findById(id);</span><br><span class="line">    <span class="comment">// 前端要显示图片需要全路径</span></span><br><span class="line">    <span class="comment">// 封装到map中，解决图片路径问题</span></span><br><span class="line">    Map&lt;String,Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line">    resultMap.put(<span class="string">&quot;setmeal&quot;</span>, setmeal); <span class="comment">// formData</span></span><br><span class="line">    resultMap.put(<span class="string">&quot;domain&quot;</span>, QiNiuUtils.DOMAIN); <span class="comment">// domain</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.QUERY_SETMEAL_SUCCESS,resultMap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询选中的检查组ids</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findCheckgroupIdsBySetmealId&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findCheckgroupIdsBySetmealId</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">    List&lt;Integer&gt; checkgroupIds = setmealService.findCheckgroupIdsBySetmealId(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.QUERY_CHECKGROUP_SUCCESS,checkgroupIds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> Setmeal setmeal, Integer[] checkgroupIds)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 调用业务服务修改</span></span><br><span class="line">    setmealService.update(setmeal, checkgroupIds);</span><br><span class="line">    <span class="comment">// 响应结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.EDIT_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-2-服务接口"><a href="#4-2-2-服务接口" class="headerlink" title="4.2.2. 服务接口"></a>4.2.2. <strong>服务接口</strong></h3><p>在SetmealService服务接口中扩展方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Setmeal <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询选中的检查组ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Integer&gt; <span class="title">findCheckgroupIdsBySetmealId</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改套餐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> checkgroupIds</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-服务实现类"><a href="#4-2-3-服务实现类" class="headerlink" title="4.2.3. 服务实现类"></a>4.2.3. <strong>服务实现类</strong></h3><p>在SetmealServiceImpl实现类中实现编辑方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Setmeal <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> setmealDao.findById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询选中的检查组ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">findCheckgroupIdsBySetmealId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> setmealDao.findCheckgroupIdsBySetmealId(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改套餐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> checkgroupIds</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先更新套餐信息</span></span><br><span class="line">    setmealDao.update(setmeal);</span><br><span class="line">    <span class="comment">// 删除旧关系</span></span><br><span class="line">    setmealDao.deleteSetmealCheckGroup(setmeal.getId());</span><br><span class="line">    <span class="comment">// 添加新关系</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> != checkgroupIds)&#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer checkgroupId : checkgroupIds) &#123;</span><br><span class="line">            setmealDao.addSetmealCheckGroup(setmeal.getId(), checkgroupId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-Dao接口"><a href="#4-2-4-Dao接口" class="headerlink" title="4.2.4. Dao接口"></a>4.2.4. <strong>Dao接口</strong></h3><p>在SetmealDao接口中扩展方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Setmeal <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询选中的检查组ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Integer&gt; <span class="title">findCheckgroupIdsBySetmealId</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新套餐信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Setmeal setmeal)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除旧关系</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteSetmealCheckGroup</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-Mapper映射文件"><a href="#4-2-5-Mapper映射文件" class="headerlink" title="4.2.5. Mapper映射文件"></a>4.2.5. <strong>Mapper映射文件</strong></h3><p>在SetmealDao.xml中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;setmeal&quot;</span>&gt;</span></span><br><span class="line">    select * From t_setmeal where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCheckgroupIdsBySetmealId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    select checkgroup_id from t_setmeal_checkgroup where setmeal_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;setmeal&quot;</span>&gt;</span></span><br><span class="line">    update t_setmeal</span><br><span class="line">    set</span><br><span class="line">        name=#&#123;name&#125;,</span><br><span class="line">        code=#&#123;code&#125;,</span><br><span class="line">        helpCode=#&#123;helpCode&#125;,</span><br><span class="line">        sex=#&#123;sex&#125;,</span><br><span class="line">        age=#&#123;age&#125;,</span><br><span class="line">        price=#&#123;price&#125;,</span><br><span class="line">        remark=#&#123;remark&#125;,</span><br><span class="line">        attention=#&#123;attention&#125;,</span><br><span class="line">        img=#&#123;img&#125;</span><br><span class="line">    where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteSetmealCheckGroup&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    delete from t_setmeal_checkgroup where setmeal_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="【小结】-3"><a href="#【小结】-3" class="headerlink" title="【小结】"></a>【小结】</h3><ul>
<li><p>添加 绑定“编辑”单击事件</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162756.png" alt="image-20200624163134301"></p>
</li>
<li><p>复制新增窗口，改为编辑窗口，添加dialogFormVisable4Edit定义为编辑窗口的展示</p>
</li>
</ul>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162757.png" alt="image-20200624163205230"></p>
<p>（2）弹出编辑窗口回显数据， 复制添加的窗口: 确定按钮绑定的事件，编辑窗口的显示控制的变量dialogFormVisiable4Edit(窗口定义，data定义)，在methods中添加handleUpdate方法(methods), 添加handleEdit方法(methods)</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162758.png" alt="image-20200624163251145"></p>
<ul>
<li><p>回显套餐数据 </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162759.png" alt="image-20200823165756142"></p>
</li>
<li><p>查询检查组列表</p>
</li>
<li><p>当前套餐具有的检查组的复选框需要选中</p>
</li>
</ul>
<p>（3）发送请求，编辑保存套餐</p>
<ul>
<li>编辑套餐更新</li>
<li>删除套餐检查组中间表数据，重新添加套餐检查组中间表数据</li>
</ul>
<h1 id="5-删除套餐"><a href="#5-删除套餐" class="headerlink" title="5.删除套餐"></a>5.删除套餐</h1><h3 id="【目标】-4"><a href="#【目标】-4" class="headerlink" title="【目标】"></a>【目标】</h3><p>删除套餐</p>
<h3 id="【路径】-4"><a href="#【路径】-4" class="headerlink" title="【路径】"></a>【路径】</h3><p>1：前台代码</p>
<ul>
<li>给删除按钮(实现编辑套餐功能时添加的)绑定删除handleDelete事件</li>
<li>获取删除的套餐id</li>
<li>弹出询问，确定后发送请求把id传给controller, 提示结果，成功则刷新列表</li>
</ul>
<p>2：后台代码</p>
<ul>
<li><p>SetmealController接收id, 调用服务删除，返回结果给前端</p>
</li>
<li><p>SetmealServiceImp</p>
<ul>
<li>判断是否被订单使用了</li>
<li>使用了，则报错</li>
<li>没使用<ul>
<li>先删除套餐与检查组的关系</li>
<li>再删除套餐数据</li>
</ul>
</li>
</ul>
</li>
<li><p>SetmealDao</p>
<ul>
<li>查询订单表中是否存在这个套餐的id select count(1) from t_order where setmeal_id=?id</li>
<li>delete from t_setmeal where id=#{id}</li>
</ul>
</li>
</ul>
<h3 id="【讲解】-4"><a href="#【讲解】-4" class="headerlink" title="【讲解】"></a>【讲解】</h3><h2 id="5-1-前台代码"><a href="#5-1-前台代码" class="headerlink" title="5.1. 前台代码"></a>5.1. 前台代码</h2><p>为了防止用户误操作，点击删除按钮时需要弹出确认删除的提示，用户点击取消则不做任何操作，用户点击确定按钮再提交删除请求。</p>
<h3 id="5-1-1-绑定单击事件"><a href="#5-1-1-绑定单击事件" class="headerlink" title="5.1.1. 绑定单击事件"></a>5.1.1. <strong>绑定单击事件</strong></h3><p>需要为删除按钮绑定单击事件，并且将当前行数据作为参数传递给处理函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>调用的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="function"><span class="title">handleDelete</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">    alert(row.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-弹出确认操作提示"><a href="#5-1-2-弹出确认操作提示" class="headerlink" title="5.1.2. 弹出确认操作提示"></a>5.1.2. <strong>弹出确认操作提示</strong></h3><p>用户点击删除按钮会执行handleDelete方法，此处需要完善handleDelete方法，弹出确认提示信息。ElementUI提供了$confirm方法来实现确认提示信息弹框效果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="function"><span class="title">handleDelete</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// alert(row.id);</span></span><br><span class="line">  	<span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将【永久删除】该套餐, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    	<span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    	<span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    	<span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">    	<span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">  	&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	<span class="comment">// 执行删除</span></span><br><span class="line">  	&#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	<span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      		<span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      		<span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">    	&#125;);</span><br><span class="line">  	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-3-发送请求"><a href="#5-1-3-发送请求" class="headerlink" title="5.1.3. 发送请求"></a>5.1.3. <strong>发送请求</strong></h3><p>如果用户点击确定按钮就需要发送ajax请求，并且将当前套餐的id作为参数提交到后台进行删除操作</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="function"><span class="title">handleDelete</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">  	<span class="comment">// alert(row.id);</span></span><br><span class="line">  	<span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将【永久删除】该套餐, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    	<span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    	<span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    	<span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">    	<span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">  	&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	<span class="comment">// 使用id作为查询条件，删除数据</span></span><br><span class="line">    	axios.get(<span class="string">&quot;/setmeal/delete.do?id=&quot;</span>+row.id).then(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">     		<span class="comment">// 返回的结果Result(flag,message,data)</span></span><br><span class="line">      		<span class="keyword">if</span>(response.data.flag)&#123;</span><br><span class="line">        		<span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          		<span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          		<span class="attr">message</span>: response.data.message</span><br><span class="line">        	&#125;);</span><br><span class="line">      		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        		<span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          			<span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">          			<span class="attr">message</span>: response.data.message</span><br><span class="line">        		&#125;);</span><br><span class="line">      		&#125;</span><br><span class="line">      		<span class="comment">// 刷新页面</span></span><br><span class="line">      		<span class="built_in">this</span>.findPage();</span><br><span class="line">    	&#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">          </span><br><span class="line">    	&#125;)</span><br><span class="line">  	&#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	<span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      		<span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      		<span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">    	&#125;);</span><br><span class="line">  	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-后台代码"><a href="#5-2-后台代码" class="headerlink" title="5.2. 后台代码"></a>5.2. <strong>后台代码</strong></h2><p>health_common添加常量定义</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211209162800.png" alt="image-20200626095524675"></p>
<h3 id="5-2-1-Controller"><a href="#5-2-1-Controller" class="headerlink" title="5.2.1. Controller"></a>5.2.1. <strong>Controller</strong></h3><p>在SetmealController中增加删除方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除套餐</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/delete&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">delete</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">    setmealService.deleteById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, MessageConstant.DELETE_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-2-服务接口"><a href="#5-2-2-服务接口" class="headerlink" title="5.2.2. 服务接口"></a>5.2.2. <strong>服务接口</strong></h3><p>在SetmealService服务接口中扩展删除方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> HealthException</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-3-服务实现类"><a href="#5-2-3-服务实现类" class="headerlink" title="5.2.3. 服务实现类"></a>5.2.3. <strong>服务实现类</strong></h3><p>注意：不能直接删除，需要判断当前套餐是否和检查组关联，如果已经和检查组进行了关联则不允许删除</p>
<p>SetmealServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除套餐</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> HealthException </span>&#123;</span><br><span class="line">  	<span class="comment">// 是否存在订单，如果存在则不能删除</span></span><br><span class="line">    <span class="keyword">int</span> count = setmealDao.findOrderCountBySetmealId(id);</span><br><span class="line">    <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 已经有订单使用了这个套餐，不能删除</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HealthException(<span class="string">&quot;已经有订单使用了这个套餐，不能删除！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 先删除套餐与检查组的关系</span></span><br><span class="line">    setmealDao.deleteSetmealCheckGroup(id);</span><br><span class="line">    <span class="comment">// 再删除套餐</span></span><br><span class="line">    setmealDao.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-4-Dao接口"><a href="#5-2-4-Dao接口" class="headerlink" title="5.2.4. Dao接口"></a>5.2.4. <strong>Dao接口</strong></h3><p>在SetmealDao接口中扩展方法findSetmealAndCheckGroupCountBySetmealId和deleteById</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过套餐的id查询使用了这个套餐的订单个数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findOrderCountBySetmealId</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id删除套餐信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-5-Mapper映射文件"><a href="#5-2-5-Mapper映射文件" class="headerlink" title="5.2.5. Mapper映射文件"></a>5.2.5. <strong>Mapper映射文件</strong></h3><p>在SetmealDao.xml中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderCountBySetmealId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    select count(1) from t_order where setmeal_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    delete from t_setmeal where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="【小结】-4"><a href="#【小结】-4" class="headerlink" title="【小结】"></a>【小结】</h3><p>是否能删除 判断的点在于是否有订单使用了这个套餐，而不是套餐与检查组的关系</p>
<p>注意：删除的业务里加上事务控制，删除的接口要加异常声明</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小肥龙吃大冰淇淋</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lvxueyangtiger.github.io/post/887a3734.html">https://lvxueyangtiger.github.io/post/887a3734.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lvxueyangtiger.github.io" target="_blank">小肥龙吃大冰淇淋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/javase%E5%9F%BA%E7%A1%80/">javase基础</a><a class="post-meta__tags" href="/tags/%E4%BC%A0%E6%99%BA%E5%81%A5%E5%BA%B7/">传智健康</a></div><div class="post_share"><div class="social-share" data-image="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082121.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/86857cf.html"><img class="prev-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082055.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">传智健康day10</div></div></a></div><div class="next-post pull-right"><a href="/post/161ea297.html"><img class="next-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212120.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">传智健康day04</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/ff7d07a2.html" title="传智健康day02"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082319.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day02</div></div></a></div><div><a href="/post/86857cf.html" title="传智健康day10"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082055.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day10</div></div></a></div><div><a href="/post/161ea297.html" title="传智健康day04"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212120.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day04</div></div></a></div><div><a href="/post/66745618.html" title="传智健康day01"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082137.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day01</div></div></a></div><div><a href="/post/68afde2a.html" title="传智健康day09"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212025.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day09</div></div></a></div><div><a href="/post/1fa8eebc.html" title="传智健康day08"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212044.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">传智健康day08</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">第3章 预约管理-套餐管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%9B%BE%E7%89%87%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88"><span class="toc-number">2.</span> <span class="toc-text">1. 图片存储方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E3%80%91"><span class="toc-number">2.0.1.</span> <span class="toc-text">【目标】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%B7%AF%E5%BE%84%E3%80%91"><span class="toc-number">2.0.2.</span> <span class="toc-text">【路径】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%AE%B2%E8%A7%A3%E3%80%91"><span class="toc-number">2.0.3.</span> <span class="toc-text">【讲解】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">1.1. 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-number">2.2.</span> <span class="toc-text">1.2. 七牛云存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E6%B3%A8%E5%86%8C%E3%80%81%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.2.1. 注册、登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E6%96%B0%E5%BB%BA%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.2.2. 新建存储空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.3.</span> <span class="toc-text">1.2.3. 查看存储空间信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%BC%80%E5%8F%91%E8%80%85%E4%B8%AD%E5%BF%83"><span class="toc-number">2.2.4.</span> <span class="toc-text">1.2.4. 开发者中心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-1-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">1.2.4.1.文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-2-%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">1.2.4.2.文件删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E9%89%B4%E6%9D%83"><span class="toc-number">2.2.5.</span> <span class="toc-text">1.2.5. 鉴权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-Java-SDK%E6%93%8D%E4%BD%9C%E4%B8%83%E7%89%9B%E4%BA%91"><span class="toc-number">2.2.6.</span> <span class="toc-text">1.2.6. Java SDK操作七牛云</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-%E5%B0%81%E8%A3%85%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">2.2.7.</span> <span class="toc-text">1.2.7. 封装工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E5%B0%8F%E7%BB%93%E3%80%91"><span class="toc-number">2.2.8.</span> <span class="toc-text">【小结】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="toc-number">3.</span> <span class="toc-text">2. 新增套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E3%80%91-1"><span class="toc-number">3.0.1.</span> <span class="toc-text">【目标】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%B7%AF%E5%BE%84%E3%80%91-1"><span class="toc-number">3.0.2.</span> <span class="toc-text">【路径】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%AE%B2%E8%A7%A3%E3%80%91-1"><span class="toc-number">3.0.3.</span> <span class="toc-text">【讲解】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">2.1. 需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">2.2. 前台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%BC%B9%E5%87%BA%E6%96%B0%E5%A2%9E%E7%AA%97%E5%8F%A3"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1. 弹出新增窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA%E6%A3%80%E6%9F%A5%E7%BB%84%E5%88%97%E8%A1%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2. 动态展示检查组列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B9%B6%E9%A2%84%E8%A7%88"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.2.3. 图片上传并预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.2.4. 提交请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">2.3. 后台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-Controller"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.3.1. Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.3.2. 服务接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">3.3.3.</span> <span class="toc-text">2.3.3. 服务实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-Dao%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.3.4.</span> <span class="toc-text">2.3.4. Dao接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.5.</span> <span class="toc-text">2.3.5. Mapper映射文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%AE%8C%E5%96%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%8CRedis%E5%AD%98%E5%82%A8%E5%9B%BE%E7%89%87%E5%90%8D%E7%A7%B0%EF%BC%88%E5%BF%BD%E7%95%A5%EF%BC%8C%E5%90%8E%E7%BB%AD%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">2.4.  完善文件上传，Redis存储图片名称（忽略，后续实现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E5%B0%8F%E7%BB%93%E3%80%91-1"><span class="toc-number">3.4.1.</span> <span class="toc-text">【小结】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E4%BD%93%E6%A3%80%E5%A5%97%E9%A4%90%E5%88%86%E9%A1%B5"><span class="toc-number">4.</span> <span class="toc-text">3. 体检套餐分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E3%80%91-2"><span class="toc-number">4.0.1.</span> <span class="toc-text">【目标】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%B7%AF%E5%BE%84%E3%80%91-2"><span class="toc-number">4.0.2.</span> <span class="toc-text">【路径】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%AE%B2%E8%A7%A3%E3%80%91-2"><span class="toc-number">4.0.3.</span> <span class="toc-text">【讲解】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">3.1. 前台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.1.</span> <span class="toc-text">3.1.1. 定义分页相关模型数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.2.</span> <span class="toc-text">3.1.2. 定义分页方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-%E5%AE%8C%E5%96%84%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-number">4.1.3.</span> <span class="toc-text">3.1.3. 完善分页方法执行时机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">3.2. 后台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-Controller"><span class="toc-number">4.2.1.</span> <span class="toc-text">3.2.1. Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.</span> <span class="toc-text">3.2.2. 服务接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">4.2.3.</span> <span class="toc-text">3.2.3. 服务实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.4.</span> <span class="toc-text">3.2.4. Dao接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.5.</span> <span class="toc-text">3.2.5. Mapper映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E5%B0%8F%E7%BB%93%E3%80%91-2"><span class="toc-number">4.2.6.</span> <span class="toc-text">【小结】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E7%BC%96%E8%BE%91%E5%A5%97%E9%A4%90"><span class="toc-number">5.</span> <span class="toc-text">4. 编辑套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E3%80%91-3"><span class="toc-number">5.0.1.</span> <span class="toc-text">【目标】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%B7%AF%E5%BE%84%E3%80%91-3"><span class="toc-number">5.0.2.</span> <span class="toc-text">【路径】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%AE%B2%E8%A7%A3%E3%80%91-3"><span class="toc-number">5.0.3.</span> <span class="toc-text">【讲解】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.1.</span> <span class="toc-text">4.1. 前台页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E7%BB%91%E5%AE%9A%E5%8D%95%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">5.1.1.</span> <span class="toc-text">4.1.1. 绑定单击事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%BC%B9%E5%87%BA%E7%BC%96%E8%BE%91%E7%AA%97%E5%8F%A3%E5%9B%9E%E6%98%BE%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">4.1.2. 弹出编辑窗口回显数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%EF%BC%8C%E7%BC%96%E8%BE%91%E4%BF%9D%E5%AD%98%E5%A5%97%E9%A4%90"><span class="toc-number">5.1.3.</span> <span class="toc-text">4.1.3. 发送请求，编辑保存套餐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.</span> <span class="toc-text">4.2. 后台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-Controller"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1. Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.2.2. 服务接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">5.2.3.</span> <span class="toc-text">4.2.3. 服务实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.2.4.</span> <span class="toc-text">4.2.4. Dao接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">5.2.5.</span> <span class="toc-text">4.2.5. Mapper映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E5%B0%8F%E7%BB%93%E3%80%91-3"><span class="toc-number">5.2.6.</span> <span class="toc-text">【小结】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="toc-number">6.</span> <span class="toc-text">5.删除套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E3%80%91-4"><span class="toc-number">6.0.1.</span> <span class="toc-text">【目标】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%B7%AF%E5%BE%84%E3%80%91-4"><span class="toc-number">6.0.2.</span> <span class="toc-text">【路径】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E8%AE%B2%E8%A7%A3%E3%80%91-4"><span class="toc-number">6.0.3.</span> <span class="toc-text">【讲解】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">6.1.</span> <span class="toc-text">5.1. 前台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E7%BB%91%E5%AE%9A%E5%8D%95%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.1.1.</span> <span class="toc-text">5.1.1. 绑定单击事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E5%BC%B9%E5%87%BA%E7%A1%AE%E8%AE%A4%E6%93%8D%E4%BD%9C%E6%8F%90%E7%A4%BA"><span class="toc-number">6.1.2.</span> <span class="toc-text">5.1.2. 弹出确认操作提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">6.1.3.</span> <span class="toc-text">5.1.3. 发送请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">6.2.</span> <span class="toc-text">5.2. 后台代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Controller"><span class="toc-number">6.2.1.</span> <span class="toc-text">5.2.1. Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.2.2.</span> <span class="toc-text">5.2.2. 服务接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">6.2.3.</span> <span class="toc-text">5.2.3. 服务实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.2.4.</span> <span class="toc-text">5.2.4. Dao接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">6.2.5.</span> <span class="toc-text">5.2.5. Mapper映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E5%B0%8F%E7%BB%93%E3%80%91-4"><span class="toc-number">6.2.6.</span> <span class="toc-text">【小结】</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 小肥龙吃大冰淇淋</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="framework-info"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202301132049386.png"/><span> </span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">晋ICP备2022012091号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'pinglun-9gh2lmcnd8587831',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'pinglun-9gh2lmcnd8587831',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script src="//code.tidio.co/smwivpnwumemac2wohardi3d3gpud1ag.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>